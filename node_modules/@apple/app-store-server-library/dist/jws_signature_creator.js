"use strict";
// Copyright (c) 2025 Apple Inc. Licensed under MIT License.
Object.defineProperty(exports, "__esModule", { value: true });
exports.AdvancedCommerceInAppSignatureCreator = exports.IntroductoryOfferEligibilitySignatureCreator = exports.PromotionalOfferV2SignatureCreator = void 0;
const jsonwebtoken = require("jsonwebtoken");
const crypto_1 = require("crypto");
class BaseSignatureCreator {
    constructor(audience, signingKey, keyId, issuerId, bundleId) {
        this.audience = audience;
        this.issuerId = issuerId;
        this.keyId = keyId;
        this.bundleId = bundleId;
        this.signingKey = signingKey;
    }
    internalCreateSignature(featureSpecificClaims) {
        var claims = featureSpecificClaims;
        claims['bid'] = this.bundleId;
        claims['nonce'] = (0, crypto_1.randomUUID)();
        return jsonwebtoken.sign(claims, this.signingKey, { algorithm: 'ES256', keyid: this.keyId, issuer: this.issuerId, audience: this.audience });
    }
}
class PromotionalOfferV2SignatureCreator extends BaseSignatureCreator {
    /**
     * Create a PromotionalOfferV2SignatureCreator
     *
     * @param signingKey Your private key downloaded from App Store Connect
     * @param keyId Your private key ID from App Store Connect
     * @param issuerId Your issuer ID from the Keys page in App Store Connect
     * @param bundleId Your app's bundle ID
     */
    constructor(signingKey, keyId, issuerId, bundleId) {
        super('promotional-offer', signingKey, keyId, issuerId, bundleId);
    }
    /**
     * Create a promotional offer V2 signature.
     *
     * @param productId The unique identifier of the product
     * @param offerIdentifier The promotional offer identifier that you set up in App Store Connect
     * @param transactionId The unique identifier of any transaction that belongs to the customer. You can use the customer's appTransactionId, even for customers who haven't made any In-App Purchases in your app. This field is optional, but recommended.
     * @return The signed JWS.
     * {@link https://developer.apple.com/documentation/storekit/generating-jws-to-sign-app-store-requests Generating JWS to sign App Store requests}
     */
    createSignature(productId, offerIdentifier, transactionId = undefined) {
        let featureSpecificClaims = {};
        featureSpecificClaims['productId'] = productId;
        featureSpecificClaims['offerIdentifier'] = offerIdentifier;
        if (transactionId != null) {
            featureSpecificClaims['transactionId'] = transactionId;
        }
        return super.internalCreateSignature(featureSpecificClaims);
    }
}
exports.PromotionalOfferV2SignatureCreator = PromotionalOfferV2SignatureCreator;
class IntroductoryOfferEligibilitySignatureCreator extends BaseSignatureCreator {
    /**
     * Create a IntroductoryOfferEligibilitySignatureCreator
     *
     * @param signingKey Your private key downloaded from App Store Connect
     * @param keyId Your private key ID from App Store Connect
     * @param issuerId Your issuer ID from the Keys page in App Store Connect
     * @param bundleId Your app's bundle ID
     */
    constructor(signingKey, keyId, issuerId, bundleId) {
        super('introductory-offer-eligibility', signingKey, keyId, issuerId, bundleId);
    }
    /**
     * Create an introductory offer eligibility signature.
     *
     * @param productId The unique identifier of the product
     * @param allowIntroductoryOffer A boolean value that determines whether the customer is eligible for an introductory offer
     * @param transactionId The unique identifier of any transaction that belongs to the customer. You can use the customer's appTransactionId, even for customers who haven't made any In-App Purchases in your app.
     * @return The signed JWS.
     * {@link https://developer.apple.com/documentation/storekit/generating-jws-to-sign-app-store-requests Generating JWS to sign App Store requests}
     */
    createSignature(productId, allowIntroductoryOffer, transactionId) {
        let featureSpecificClaims = {};
        featureSpecificClaims['productId'] = productId;
        featureSpecificClaims['allowIntroductoryOffer'] = allowIntroductoryOffer;
        featureSpecificClaims['transactionId'] = transactionId;
        return super.internalCreateSignature(featureSpecificClaims);
    }
}
exports.IntroductoryOfferEligibilitySignatureCreator = IntroductoryOfferEligibilitySignatureCreator;
class AdvancedCommerceInAppSignatureCreator extends BaseSignatureCreator {
    /**
     * Create a AdvancedCommerceInAppSignatureCreator
     *
     * @param signingKey Your private key downloaded from App Store Connect
     * @param keyId Your private key ID from App Store Connect
     * @param issuerId Your issuer ID from the Keys page in App Store Connect
     * @param bundleId Your app's bundle ID
     */
    constructor(signingKey, keyId, issuerId, bundleId) {
        super('advanced-commerce-api', signingKey, keyId, issuerId, bundleId);
    }
    /**
     * Create an Advanced Commerce in-app signed request.
     *
     * @param AdvancedCommerceInAppRequest The request to be signed.
     * @return The signed JWS.
     * {@link https://developer.apple.com/documentation/storekit/generating-jws-to-sign-app-store-requests Generating JWS to sign App Store requests}
     */
    createSignature(AdvancedCommerceInAppRequest) {
        let jsonRequest = JSON.stringify(AdvancedCommerceInAppRequest);
        let base64Request = Buffer.from(jsonRequest, 'utf-8').toString('base64');
        let featureSpecificClaims = {};
        featureSpecificClaims['request'] = base64Request;
        return super.internalCreateSignature(featureSpecificClaims);
    }
}
exports.AdvancedCommerceInAppSignatureCreator = AdvancedCommerceInAppSignatureCreator;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiandzX3NpZ25hdHVyZV9jcmVhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vandzX3NpZ25hdHVyZV9jcmVhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSw0REFBNEQ7OztBQUU1RCw2Q0FBOEM7QUFDOUMsbUNBQW9DO0FBRXBDLE1BQU0sb0JBQW9CO0lBT3RCLFlBQW1CLFFBQWdCLEVBQUUsVUFBa0IsRUFBRSxLQUFhLEVBQUUsUUFBZ0IsRUFBRSxRQUFnQjtRQUN0RyxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQTtRQUN4QixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQTtRQUN4QixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQTtRQUNsQixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQTtRQUN4QixJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQTtJQUNoQyxDQUFDO0lBRVMsdUJBQXVCLENBQUMscUJBQTZDO1FBQzNFLElBQUksTUFBTSxHQUFHLHFCQUFxQixDQUFBO1FBRWxDLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFBO1FBQzdCLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxJQUFBLG1CQUFVLEdBQUUsQ0FBQTtRQUU5QixPQUFPLFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFDLENBQUMsQ0FBQTtJQUMvSSxDQUFDO0NBQ0o7QUFFRCxNQUFhLGtDQUFtQyxTQUFRLG9CQUFvQjtJQUN4RTs7Ozs7OztPQU9HO0lBQ0gsWUFBbUIsVUFBa0IsRUFBRSxLQUFhLEVBQUUsUUFBZ0IsRUFBRSxRQUFnQjtRQUNwRixLQUFLLENBQUMsbUJBQW1CLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFDckUsQ0FBQztJQUVEOzs7Ozs7OztPQVFHO0lBQ0ksZUFBZSxDQUFDLFNBQWlCLEVBQUUsZUFBdUIsRUFBRSxnQkFBb0MsU0FBUztRQUM1RyxJQUFJLHFCQUFxQixHQUEyQixFQUFFLENBQUE7UUFDdEQscUJBQXFCLENBQUMsV0FBVyxDQUFDLEdBQUcsU0FBUyxDQUFBO1FBQzlDLHFCQUFxQixDQUFDLGlCQUFpQixDQUFDLEdBQUcsZUFBZSxDQUFBO1FBQzFELElBQUksYUFBYSxJQUFJLElBQUksRUFBRSxDQUFDO1lBQ3hCLHFCQUFxQixDQUFDLGVBQWUsQ0FBQyxHQUFHLGFBQWEsQ0FBQTtRQUMxRCxDQUFDO1FBQ0QsT0FBTyxLQUFLLENBQUMsdUJBQXVCLENBQUMscUJBQXFCLENBQUMsQ0FBQTtJQUMvRCxDQUFDO0NBQ0o7QUEvQkQsZ0ZBK0JDO0FBRUQsTUFBYSw0Q0FBNkMsU0FBUSxvQkFBb0I7SUFDbEY7Ozs7Ozs7T0FPRztJQUNILFlBQW1CLFVBQWtCLEVBQUUsS0FBYSxFQUFFLFFBQWdCLEVBQUUsUUFBZ0I7UUFDcEYsS0FBSyxDQUFDLGdDQUFnQyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFBO0lBQ2xGLENBQUM7SUFFRDs7Ozs7Ozs7T0FRRztJQUNJLGVBQWUsQ0FBQyxTQUFpQixFQUFFLHNCQUErQixFQUFFLGFBQXFCO1FBQzVGLElBQUkscUJBQXFCLEdBQTJCLEVBQUUsQ0FBQTtRQUN0RCxxQkFBcUIsQ0FBQyxXQUFXLENBQUMsR0FBRyxTQUFTLENBQUE7UUFDOUMscUJBQXFCLENBQUMsd0JBQXdCLENBQUMsR0FBRyxzQkFBc0IsQ0FBQTtRQUN4RSxxQkFBcUIsQ0FBQyxlQUFlLENBQUMsR0FBRyxhQUFhLENBQUE7UUFDdEQsT0FBTyxLQUFLLENBQUMsdUJBQXVCLENBQUMscUJBQXFCLENBQUMsQ0FBQTtJQUMvRCxDQUFDO0NBQ0o7QUE3QkQsb0dBNkJDO0FBSUQsTUFBYSxxQ0FBc0MsU0FBUSxvQkFBb0I7SUFDM0U7Ozs7Ozs7T0FPRztJQUNILFlBQW1CLFVBQWtCLEVBQUUsS0FBYSxFQUFFLFFBQWdCLEVBQUUsUUFBZ0I7UUFDcEYsS0FBSyxDQUFDLHVCQUF1QixFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFBO0lBQ3pFLENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSSxlQUFlLENBQUMsNEJBQTBEO1FBQzdFLElBQUksV0FBVyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsNEJBQTRCLENBQUMsQ0FBQTtRQUU5RCxJQUFJLGFBQWEsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUE7UUFFeEUsSUFBSSxxQkFBcUIsR0FBOEIsRUFBRSxDQUFBO1FBQ3pELHFCQUFxQixDQUFDLFNBQVMsQ0FBQyxHQUFHLGFBQWEsQ0FBQTtRQUNoRCxPQUFPLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFBO0lBQy9ELENBQUM7Q0FDSjtBQTdCRCxzRkE2QkMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIDIwMjUgQXBwbGUgSW5jLiBMaWNlbnNlZCB1bmRlciBNSVQgTGljZW5zZS5cblxuaW1wb3J0IGpzb253ZWJ0b2tlbiA9IHJlcXVpcmUoJ2pzb253ZWJ0b2tlbicpO1xuaW1wb3J0IHsgcmFuZG9tVVVJRCB9IGZyb20gJ2NyeXB0byc7XG5cbmNsYXNzIEJhc2VTaWduYXR1cmVDcmVhdG9yIHtcbiAgICBwcml2YXRlIGF1ZGllbmNlOiBzdHJpbmdcbiAgICBwcml2YXRlIHNpZ25pbmdLZXk6IHN0cmluZ1xuICAgIHByaXZhdGUga2V5SWQ6IHN0cmluZ1xuICAgIHByaXZhdGUgaXNzdWVySWQ6IHN0cmluZ1xuICAgIHByaXZhdGUgYnVuZGxlSWQ6IHN0cmluZ1xuXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKGF1ZGllbmNlOiBzdHJpbmcsIHNpZ25pbmdLZXk6IHN0cmluZywga2V5SWQ6IHN0cmluZywgaXNzdWVySWQ6IHN0cmluZywgYnVuZGxlSWQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLmF1ZGllbmNlID0gYXVkaWVuY2VcbiAgICAgICAgdGhpcy5pc3N1ZXJJZCA9IGlzc3VlcklkXG4gICAgICAgIHRoaXMua2V5SWQgPSBrZXlJZFxuICAgICAgICB0aGlzLmJ1bmRsZUlkID0gYnVuZGxlSWRcbiAgICAgICAgdGhpcy5zaWduaW5nS2V5ID0gc2lnbmluZ0tleVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBpbnRlcm5hbENyZWF0ZVNpZ25hdHVyZShmZWF0dXJlU3BlY2lmaWNDbGFpbXM6IHsgW2tleTogc3RyaW5nXTogYW55IH0pIHtcbiAgICAgICAgdmFyIGNsYWltcyA9IGZlYXR1cmVTcGVjaWZpY0NsYWltc1xuICAgICAgICBcbiAgICAgICAgY2xhaW1zWydiaWQnXSA9IHRoaXMuYnVuZGxlSWRcbiAgICAgICAgY2xhaW1zWydub25jZSddID0gcmFuZG9tVVVJRCgpXG5cbiAgICAgICAgcmV0dXJuIGpzb253ZWJ0b2tlbi5zaWduKGNsYWltcywgdGhpcy5zaWduaW5nS2V5LCB7IGFsZ29yaXRobTogJ0VTMjU2Jywga2V5aWQ6IHRoaXMua2V5SWQsIGlzc3VlcjogdGhpcy5pc3N1ZXJJZCwgYXVkaWVuY2U6IHRoaXMuYXVkaWVuY2V9KVxuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIFByb21vdGlvbmFsT2ZmZXJWMlNpZ25hdHVyZUNyZWF0b3IgZXh0ZW5kcyBCYXNlU2lnbmF0dXJlQ3JlYXRvciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgUHJvbW90aW9uYWxPZmZlclYyU2lnbmF0dXJlQ3JlYXRvclxuICAgICAqIFxuICAgICAqIEBwYXJhbSBzaWduaW5nS2V5IFlvdXIgcHJpdmF0ZSBrZXkgZG93bmxvYWRlZCBmcm9tIEFwcCBTdG9yZSBDb25uZWN0XG4gICAgICogQHBhcmFtIGtleUlkIFlvdXIgcHJpdmF0ZSBrZXkgSUQgZnJvbSBBcHAgU3RvcmUgQ29ubmVjdFxuICAgICAqIEBwYXJhbSBpc3N1ZXJJZCBZb3VyIGlzc3VlciBJRCBmcm9tIHRoZSBLZXlzIHBhZ2UgaW4gQXBwIFN0b3JlIENvbm5lY3RcbiAgICAgKiBAcGFyYW0gYnVuZGxlSWQgWW91ciBhcHAncyBidW5kbGUgSURcbiAgICAgKi9cbiAgICBwdWJsaWMgY29uc3RydWN0b3Ioc2lnbmluZ0tleTogc3RyaW5nLCBrZXlJZDogc3RyaW5nLCBpc3N1ZXJJZDogc3RyaW5nLCBidW5kbGVJZDogc3RyaW5nKSB7XG4gICAgICAgIHN1cGVyKCdwcm9tb3Rpb25hbC1vZmZlcicsIHNpZ25pbmdLZXksIGtleUlkLCBpc3N1ZXJJZCwgYnVuZGxlSWQpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgcHJvbW90aW9uYWwgb2ZmZXIgVjIgc2lnbmF0dXJlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHByb2R1Y3RJZCBUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIHByb2R1Y3RcbiAgICAgKiBAcGFyYW0gb2ZmZXJJZGVudGlmaWVyIFRoZSBwcm9tb3Rpb25hbCBvZmZlciBpZGVudGlmaWVyIHRoYXQgeW91IHNldCB1cCBpbiBBcHAgU3RvcmUgQ29ubmVjdFxuICAgICAqIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiBhbnkgdHJhbnNhY3Rpb24gdGhhdCBiZWxvbmdzIHRvIHRoZSBjdXN0b21lci4gWW91IGNhbiB1c2UgdGhlIGN1c3RvbWVyJ3MgYXBwVHJhbnNhY3Rpb25JZCwgZXZlbiBmb3IgY3VzdG9tZXJzIHdobyBoYXZlbid0IG1hZGUgYW55IEluLUFwcCBQdXJjaGFzZXMgaW4geW91ciBhcHAuIFRoaXMgZmllbGQgaXMgb3B0aW9uYWwsIGJ1dCByZWNvbW1lbmRlZC5cbiAgICAgKiBAcmV0dXJuIFRoZSBzaWduZWQgSldTLlxuICAgICAqIHtAbGluayBodHRwczovL2RldmVsb3Blci5hcHBsZS5jb20vZG9jdW1lbnRhdGlvbi9zdG9yZWtpdC9nZW5lcmF0aW5nLWp3cy10by1zaWduLWFwcC1zdG9yZS1yZXF1ZXN0cyBHZW5lcmF0aW5nIEpXUyB0byBzaWduIEFwcCBTdG9yZSByZXF1ZXN0c31cbiAgICAgKi9cbiAgICBwdWJsaWMgY3JlYXRlU2lnbmF0dXJlKHByb2R1Y3RJZDogc3RyaW5nLCBvZmZlcklkZW50aWZpZXI6IHN0cmluZywgdHJhbnNhY3Rpb25JZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGxldCBmZWF0dXJlU3BlY2lmaWNDbGFpbXM6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7fVxuICAgICAgICBmZWF0dXJlU3BlY2lmaWNDbGFpbXNbJ3Byb2R1Y3RJZCddID0gcHJvZHVjdElkXG4gICAgICAgIGZlYXR1cmVTcGVjaWZpY0NsYWltc1snb2ZmZXJJZGVudGlmaWVyJ10gPSBvZmZlcklkZW50aWZpZXJcbiAgICAgICAgaWYgKHRyYW5zYWN0aW9uSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgZmVhdHVyZVNwZWNpZmljQ2xhaW1zWyd0cmFuc2FjdGlvbklkJ10gPSB0cmFuc2FjdGlvbklkXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1cGVyLmludGVybmFsQ3JlYXRlU2lnbmF0dXJlKGZlYXR1cmVTcGVjaWZpY0NsYWltcylcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBJbnRyb2R1Y3RvcnlPZmZlckVsaWdpYmlsaXR5U2lnbmF0dXJlQ3JlYXRvciBleHRlbmRzIEJhc2VTaWduYXR1cmVDcmVhdG9yIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBJbnRyb2R1Y3RvcnlPZmZlckVsaWdpYmlsaXR5U2lnbmF0dXJlQ3JlYXRvclxuICAgICAqIFxuICAgICAqIEBwYXJhbSBzaWduaW5nS2V5IFlvdXIgcHJpdmF0ZSBrZXkgZG93bmxvYWRlZCBmcm9tIEFwcCBTdG9yZSBDb25uZWN0XG4gICAgICogQHBhcmFtIGtleUlkIFlvdXIgcHJpdmF0ZSBrZXkgSUQgZnJvbSBBcHAgU3RvcmUgQ29ubmVjdFxuICAgICAqIEBwYXJhbSBpc3N1ZXJJZCBZb3VyIGlzc3VlciBJRCBmcm9tIHRoZSBLZXlzIHBhZ2UgaW4gQXBwIFN0b3JlIENvbm5lY3RcbiAgICAgKiBAcGFyYW0gYnVuZGxlSWQgWW91ciBhcHAncyBidW5kbGUgSURcbiAgICAgKi9cbiAgICBwdWJsaWMgY29uc3RydWN0b3Ioc2lnbmluZ0tleTogc3RyaW5nLCBrZXlJZDogc3RyaW5nLCBpc3N1ZXJJZDogc3RyaW5nLCBidW5kbGVJZDogc3RyaW5nKSB7XG4gICAgICAgIHN1cGVyKCdpbnRyb2R1Y3Rvcnktb2ZmZXItZWxpZ2liaWxpdHknLCBzaWduaW5nS2V5LCBrZXlJZCwgaXNzdWVySWQsIGJ1bmRsZUlkKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhbiBpbnRyb2R1Y3Rvcnkgb2ZmZXIgZWxpZ2liaWxpdHkgc2lnbmF0dXJlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHByb2R1Y3RJZCBUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIHByb2R1Y3RcbiAgICAgKiBAcGFyYW0gYWxsb3dJbnRyb2R1Y3RvcnlPZmZlciBBIGJvb2xlYW4gdmFsdWUgdGhhdCBkZXRlcm1pbmVzIHdoZXRoZXIgdGhlIGN1c3RvbWVyIGlzIGVsaWdpYmxlIGZvciBhbiBpbnRyb2R1Y3Rvcnkgb2ZmZXJcbiAgICAgKiBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgYW55IHRyYW5zYWN0aW9uIHRoYXQgYmVsb25ncyB0byB0aGUgY3VzdG9tZXIuIFlvdSBjYW4gdXNlIHRoZSBjdXN0b21lcidzIGFwcFRyYW5zYWN0aW9uSWQsIGV2ZW4gZm9yIGN1c3RvbWVycyB3aG8gaGF2ZW4ndCBtYWRlIGFueSBJbi1BcHAgUHVyY2hhc2VzIGluIHlvdXIgYXBwLlxuICAgICAqIEByZXR1cm4gVGhlIHNpZ25lZCBKV1MuXG4gICAgICoge0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLmFwcGxlLmNvbS9kb2N1bWVudGF0aW9uL3N0b3Jla2l0L2dlbmVyYXRpbmctandzLXRvLXNpZ24tYXBwLXN0b3JlLXJlcXVlc3RzIEdlbmVyYXRpbmcgSldTIHRvIHNpZ24gQXBwIFN0b3JlIHJlcXVlc3RzfVxuICAgICAqL1xuICAgIHB1YmxpYyBjcmVhdGVTaWduYXR1cmUocHJvZHVjdElkOiBzdHJpbmcsIGFsbG93SW50cm9kdWN0b3J5T2ZmZXI6IGJvb2xlYW4sIHRyYW5zYWN0aW9uSWQ6IHN0cmluZykge1xuICAgICAgICBsZXQgZmVhdHVyZVNwZWNpZmljQ2xhaW1zOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0ge31cbiAgICAgICAgZmVhdHVyZVNwZWNpZmljQ2xhaW1zWydwcm9kdWN0SWQnXSA9IHByb2R1Y3RJZFxuICAgICAgICBmZWF0dXJlU3BlY2lmaWNDbGFpbXNbJ2FsbG93SW50cm9kdWN0b3J5T2ZmZXInXSA9IGFsbG93SW50cm9kdWN0b3J5T2ZmZXJcbiAgICAgICAgZmVhdHVyZVNwZWNpZmljQ2xhaW1zWyd0cmFuc2FjdGlvbklkJ10gPSB0cmFuc2FjdGlvbklkXG4gICAgICAgIHJldHVybiBzdXBlci5pbnRlcm5hbENyZWF0ZVNpZ25hdHVyZShmZWF0dXJlU3BlY2lmaWNDbGFpbXMpXG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFkdmFuY2VkQ29tbWVyY2VJbkFwcFJlcXVlc3Qge31cblxuZXhwb3J0IGNsYXNzIEFkdmFuY2VkQ29tbWVyY2VJbkFwcFNpZ25hdHVyZUNyZWF0b3IgZXh0ZW5kcyBCYXNlU2lnbmF0dXJlQ3JlYXRvciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgQWR2YW5jZWRDb21tZXJjZUluQXBwU2lnbmF0dXJlQ3JlYXRvclxuICAgICAqIFxuICAgICAqIEBwYXJhbSBzaWduaW5nS2V5IFlvdXIgcHJpdmF0ZSBrZXkgZG93bmxvYWRlZCBmcm9tIEFwcCBTdG9yZSBDb25uZWN0XG4gICAgICogQHBhcmFtIGtleUlkIFlvdXIgcHJpdmF0ZSBrZXkgSUQgZnJvbSBBcHAgU3RvcmUgQ29ubmVjdFxuICAgICAqIEBwYXJhbSBpc3N1ZXJJZCBZb3VyIGlzc3VlciBJRCBmcm9tIHRoZSBLZXlzIHBhZ2UgaW4gQXBwIFN0b3JlIENvbm5lY3RcbiAgICAgKiBAcGFyYW0gYnVuZGxlSWQgWW91ciBhcHAncyBidW5kbGUgSURcbiAgICAgKi9cbiAgICBwdWJsaWMgY29uc3RydWN0b3Ioc2lnbmluZ0tleTogc3RyaW5nLCBrZXlJZDogc3RyaW5nLCBpc3N1ZXJJZDogc3RyaW5nLCBidW5kbGVJZDogc3RyaW5nKSB7XG4gICAgICAgIHN1cGVyKCdhZHZhbmNlZC1jb21tZXJjZS1hcGknLCBzaWduaW5nS2V5LCBrZXlJZCwgaXNzdWVySWQsIGJ1bmRsZUlkKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhbiBBZHZhbmNlZCBDb21tZXJjZSBpbi1hcHAgc2lnbmVkIHJlcXVlc3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gQWR2YW5jZWRDb21tZXJjZUluQXBwUmVxdWVzdCBUaGUgcmVxdWVzdCB0byBiZSBzaWduZWQuXG4gICAgICogQHJldHVybiBUaGUgc2lnbmVkIEpXUy5cbiAgICAgKiB7QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL2RvY3VtZW50YXRpb24vc3RvcmVraXQvZ2VuZXJhdGluZy1qd3MtdG8tc2lnbi1hcHAtc3RvcmUtcmVxdWVzdHMgR2VuZXJhdGluZyBKV1MgdG8gc2lnbiBBcHAgU3RvcmUgcmVxdWVzdHN9XG4gICAgICovXG4gICAgcHVibGljIGNyZWF0ZVNpZ25hdHVyZShBZHZhbmNlZENvbW1lcmNlSW5BcHBSZXF1ZXN0OiBBZHZhbmNlZENvbW1lcmNlSW5BcHBSZXF1ZXN0KSB7XG4gICAgICAgIGxldCBqc29uUmVxdWVzdCA9IEpTT04uc3RyaW5naWZ5KEFkdmFuY2VkQ29tbWVyY2VJbkFwcFJlcXVlc3QpXG4gICAgICAgIFxuICAgICAgICBsZXQgYmFzZTY0UmVxdWVzdCA9IEJ1ZmZlci5mcm9tKGpzb25SZXF1ZXN0LCAndXRmLTgnKS50b1N0cmluZygnYmFzZTY0JylcblxuICAgICAgICBsZXQgZmVhdHVyZVNwZWNpZmljQ2xhaW1zOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0ge31cbiAgICAgICAgZmVhdHVyZVNwZWNpZmljQ2xhaW1zWydyZXF1ZXN0J10gPSBiYXNlNjRSZXF1ZXN0XG4gICAgICAgIHJldHVybiBzdXBlci5pbnRlcm5hbENyZWF0ZVNpZ25hdHVyZShmZWF0dXJlU3BlY2lmaWNDbGFpbXMpXG4gICAgfVxufSJdfQ==