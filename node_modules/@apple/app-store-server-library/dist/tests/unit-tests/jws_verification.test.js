"use strict";
// Copyright (c) 2023 Apple Inc. Licensed under MIT License.
Object.defineProperty(exports, "__esModule", { value: true });
const assert = require("assert");
const crypto_1 = require("crypto");
const jws_verification_1 = require("../../jws_verification");
const Environment_1 = require("../../models/Environment");
const util_1 = require("../util");
const ROOT_CA_BASE64_ENCODED = "MIIBgjCCASmgAwIBAgIJALUc5ALiH5pbMAoGCCqGSM49BAMDMDYxCzAJBgNVBAYTAlVTMRMwEQYDVQQIDApDYWxpZm9ybmlhMRIwEAYDVQQHDAlDdXBlcnRpbm8wHhcNMjMwMTA1MjEzMDIyWhcNMzMwMTAyMjEzMDIyWjA2MQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTESMBAGA1UEBwwJQ3VwZXJ0aW5vMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEc+/Bl+gospo6tf9Z7io5tdKdrlN1YdVnqEhEDXDShzdAJPQijamXIMHf8xWWTa1zgoYTxOKpbuJtDplz1XriTaMgMB4wDAYDVR0TBAUwAwEB/zAOBgNVHQ8BAf8EBAMCAQYwCgYIKoZIzj0EAwMDRwAwRAIgemWQXnMAdTad2JDJWng9U4uBBL5mA7WI05H7oH7c6iQCIHiRqMjNfzUAyiu9h6rOU/K+iTR0I/3Y/NSWsXHX+acc";
const INTERMEDIATE_CA_BASE64_ENCODED = "MIIBnzCCAUWgAwIBAgIBCzAKBggqhkjOPQQDAzA2MQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTESMBAGA1UEBwwJQ3VwZXJ0aW5vMB4XDTIzMDEwNTIxMzEwNVoXDTMzMDEwMTIxMzEwNVowRTELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRIwEAYDVQQHDAlDdXBlcnRpbm8xFTATBgNVBAoMDEludGVybWVkaWF0ZTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABBUN5V9rKjfRiMAIojEA0Av5Mp0oF+O0cL4gzrTF178inUHugj7Et46NrkQ7hKgMVnjogq45Q1rMs+cMHVNILWqjNTAzMA8GA1UdEwQIMAYBAf8CAQAwDgYDVR0PAQH/BAQDAgEGMBAGCiqGSIb3Y2QGAgEEAgUAMAoGCCqGSM49BAMDA0gAMEUCIQCmsIKYs41ullssHX4rVveUT0Z7Is5/hLK1lFPTtun3hAIgc2+2RG5+gNcFVcs+XJeEl4GZ+ojl3ROOmll+ye7dynQ=";
const LEAF_CERT_BASE64_ENCODED = "MIIBoDCCAUagAwIBAgIBDDAKBggqhkjOPQQDAzBFMQswCQYDVQQGEwJVUzELMAkGA1UECAwCQ0ExEjAQBgNVBAcMCUN1cGVydGlubzEVMBMGA1UECgwMSW50ZXJtZWRpYXRlMB4XDTIzMDEwNTIxMzEzNFoXDTMzMDEwMTIxMzEzNFowPTELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRIwEAYDVQQHDAlDdXBlcnRpbm8xDTALBgNVBAoMBExlYWYwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAATitYHEaYVuc8g9AjTOwErMvGyPykPa+puvTI8hJTHZZDLGas2qX1+ErxgQTJgVXv76nmLhhRJH+j25AiAI8iGsoy8wLTAJBgNVHRMEAjAAMA4GA1UdDwEB/wQEAwIHgDAQBgoqhkiG92NkBgsBBAIFADAKBggqhkjOPQQDAwNIADBFAiBX4c+T0Fp5nJ5QRClRfu5PSByRvNPtuaTsk0vPB3WAIAIhANgaauAj/YP9s0AkEhyJhxQO/6Q2zouZ+H1CIOehnMzQ";
const INTERMEDIATE_CA_INVALID_OID_BASE64_ENCODED = "MIIBnjCCAUWgAwIBAgIBDTAKBggqhkjOPQQDAzA2MQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTESMBAGA1UEBwwJQ3VwZXJ0aW5vMB4XDTIzMDEwNTIxMzYxNFoXDTMzMDEwMTIxMzYxNFowRTELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRIwEAYDVQQHDAlDdXBlcnRpbm8xFTATBgNVBAoMDEludGVybWVkaWF0ZTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABBUN5V9rKjfRiMAIojEA0Av5Mp0oF+O0cL4gzrTF178inUHugj7Et46NrkQ7hKgMVnjogq45Q1rMs+cMHVNILWqjNTAzMA8GA1UdEwQIMAYBAf8CAQAwDgYDVR0PAQH/BAQDAgEGMBAGCiqGSIb3Y2QGAgIEAgUAMAoGCCqGSM49BAMDA0cAMEQCIFROtTE+RQpKxNXETFsf7Mc0h+5IAsxxo/X6oCC/c33qAiAmC5rn5yCOOEjTY4R1H1QcQVh+eUwCl13NbQxWCuwxxA==";
const LEAF_CERT_FOR_INTERMEDIATE_CA_INVALID_OID_BASE64_ENCODED = "MIIBnzCCAUagAwIBAgIBDjAKBggqhkjOPQQDAzBFMQswCQYDVQQGEwJVUzELMAkGA1UECAwCQ0ExEjAQBgNVBAcMCUN1cGVydGlubzEVMBMGA1UECgwMSW50ZXJtZWRpYXRlMB4XDTIzMDEwNTIxMzY1OFoXDTMzMDEwMTIxMzY1OFowPTELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRIwEAYDVQQHDAlDdXBlcnRpbm8xDTALBgNVBAoMBExlYWYwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAATitYHEaYVuc8g9AjTOwErMvGyPykPa+puvTI8hJTHZZDLGas2qX1+ErxgQTJgVXv76nmLhhRJH+j25AiAI8iGsoy8wLTAJBgNVHRMEAjAAMA4GA1UdDwEB/wQEAwIHgDAQBgoqhkiG92NkBgsBBAIFADAKBggqhkjOPQQDAwNHADBEAiAUAs+gzYOsEXDwQquvHYbcVymyNqDtGw9BnUFp2YLuuAIgXxQ3Ie9YU0cMqkeaFd+lyo0asv9eyzk6stwjeIeOtTU=";
const LEAF_CERT_INVALID_OID_BASE64_ENCODED = "MIIBoDCCAUagAwIBAgIBDzAKBggqhkjOPQQDAzBFMQswCQYDVQQGEwJVUzELMAkGA1UECAwCQ0ExEjAQBgNVBAcMCUN1cGVydGlubzEVMBMGA1UECgwMSW50ZXJtZWRpYXRlMB4XDTIzMDEwNTIxMzczMVoXDTMzMDEwMTIxMzczMVowPTELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRIwEAYDVQQHDAlDdXBlcnRpbm8xDTALBgNVBAoMBExlYWYwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAATitYHEaYVuc8g9AjTOwErMvGyPykPa+puvTI8hJTHZZDLGas2qX1+ErxgQTJgVXv76nmLhhRJH+j25AiAI8iGsoy8wLTAJBgNVHRMEAjAAMA4GA1UdDwEB/wQEAwIHgDAQBgoqhkiG92NkBgsCBAIFADAKBggqhkjOPQQDAwNIADBFAiAb+7S3i//bSGy7skJY9+D4VgcQLKFeYfIMSrUCmdrFqwIhAIMVwzD1RrxPRtJyiOCXLyibIvwcY+VS73HYfk0O9lgz";
const LEAF_CERT_PUBLIC_KEY_BASE64_ENCODED = "MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE4rWBxGmFbnPIPQI0zsBKzLxsj8pD2vqbr0yPISUx2WQyxmrNql9fhK8YEEyYFV7++p5i4YUSR/o9uQIgCPIhrA==";
const REAL_APPLE_ROOT_BASE64_ENCODED = "MIICQzCCAcmgAwIBAgIILcX8iNLFS5UwCgYIKoZIzj0EAwMwZzEbMBkGA1UEAwwSQXBwbGUgUm9vdCBDQSAtIEczMSYwJAYDVQQLDB1BcHBsZSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTETMBEGA1UECgwKQXBwbGUgSW5jLjELMAkGA1UEBhMCVVMwHhcNMTQwNDMwMTgxOTA2WhcNMzkwNDMwMTgxOTA2WjBnMRswGQYDVQQDDBJBcHBsZSBSb290IENBIC0gRzMxJjAkBgNVBAsMHUFwcGxlIENlcnRpZmljYXRpb24gQXV0aG9yaXR5MRMwEQYDVQQKDApBcHBsZSBJbmMuMQswCQYDVQQGEwJVUzB2MBAGByqGSM49AgEGBSuBBAAiA2IABJjpLz1AcqTtkyJygRMc3RCV8cWjTnHcFBbZDuWmBSp3ZHtfTjjTuxxEtX/1H7YyYl3J6YRbTzBPEVoA/VhYDKX1DyxNB0cTddqXl5dvMVztK517IDvYuVTZXpmkOlEKMaNCMEAwHQYDVR0OBBYEFLuw3qFYM4iapIqZ3r6966/ayySrMA8GA1UdEwEB/wQFMAMBAf8wDgYDVR0PAQH/BAQDAgEGMAoGCCqGSM49BAMDA2gAMGUCMQCD6cHEFl4aXTQY2e3v9GwOAEZLuN+yRhHFD/3meoyhpmvOwgPUnPWTxnS4at+qIxUCMG1mihDK1A3UT82NQz60imOlM27jbdoXt2QfyFMm+YhidDkLF1vLUagM6BgD56KyKA==";
const REAL_APPLE_INTERMEDIATE_BASE64_ENCODED = "MIIDFjCCApygAwIBAgIUIsGhRwp0c2nvU4YSycafPTjzbNcwCgYIKoZIzj0EAwMwZzEbMBkGA1UEAwwSQXBwbGUgUm9vdCBDQSAtIEczMSYwJAYDVQQLDB1BcHBsZSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTETMBEGA1UECgwKQXBwbGUgSW5jLjELMAkGA1UEBhMCVVMwHhcNMjEwMzE3MjAzNzEwWhcNMzYwMzE5MDAwMDAwWjB1MUQwQgYDVQQDDDtBcHBsZSBXb3JsZHdpZGUgRGV2ZWxvcGVyIFJlbGF0aW9ucyBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTELMAkGA1UECwwCRzYxEzARBgNVBAoMCkFwcGxlIEluYy4xCzAJBgNVBAYTAlVTMHYwEAYHKoZIzj0CAQYFK4EEACIDYgAEbsQKC94PrlWmZXnXgtxzdVJL8T0SGYngDRGpngn3N6PT8JMEb7FDi4bBmPhCnZ3/sq6PF/cGcKXWsL5vOteRhyJ45x3ASP7cOB+aao90fcpxSv/EZFbniAbNgZGhIhpIo4H6MIH3MBIGA1UdEwEB/wQIMAYBAf8CAQAwHwYDVR0jBBgwFoAUu7DeoVgziJqkipnevr3rr9rLJKswRgYIKwYBBQUHAQEEOjA4MDYGCCsGAQUFBzABhipodHRwOi8vb2NzcC5hcHBsZS5jb20vb2NzcDAzLWFwcGxlcm9vdGNhZzMwNwYDVR0fBDAwLjAsoCqgKIYmaHR0cDovL2NybC5hcHBsZS5jb20vYXBwbGVyb290Y2FnMy5jcmwwHQYDVR0OBBYEFD8vlCNR01DJmig97bB85c+lkGKZMA4GA1UdDwEB/wQEAwIBBjAQBgoqhkiG92NkBgIBBAIFADAKBggqhkjOPQQDAwNoADBlAjBAXhSq5IyKogMCPtw490BaB677CaEGJXufQB/EqZGd6CSjiCtOnuMTbXVXmxxcxfkCMQDTSPxarZXvNrkxU3TkUMI33yzvFVVRT4wxWJC994OsdcZ4+RGNsYDyR5gmdr0nDGg=";
const REAL_APPLE_SIGNING_CERTIFICATE_BASE64_ENCODED = "MIIEMTCCA7agAwIBAgIQR8KHzdn554Z/UoradNx9tzAKBggqhkjOPQQDAzB1MUQwQgYDVQQDDDtBcHBsZSBXb3JsZHdpZGUgRGV2ZWxvcGVyIFJlbGF0aW9ucyBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTELMAkGA1UECwwCRzYxEzARBgNVBAoMCkFwcGxlIEluYy4xCzAJBgNVBAYTAlVTMB4XDTI1MDkxOTE5NDQ1MVoXDTI3MTAxMzE3NDcyM1owgZIxQDA+BgNVBAMMN1Byb2QgRUNDIE1hYyBBcHAgU3RvcmUgYW5kIGlUdW5lcyBTdG9yZSBSZWNlaXB0IFNpZ25pbmcxLDAqBgNVBAsMI0FwcGxlIFdvcmxkd2lkZSBEZXZlbG9wZXIgUmVsYXRpb25zMRMwEQYDVQQKDApBcHBsZSBJbmMuMQswCQYDVQQGEwJVUzBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABNnVvhcv7iT+7Ex5tBMBgrQspHzIsXRi0Yxfek7lv8wEmj/bHiWtNwJqc2BoHzsQiEjP7KFIIKg4Y8y0/nynuAmjggIIMIICBDAMBgNVHRMBAf8EAjAAMB8GA1UdIwQYMBaAFD8vlCNR01DJmig97bB85c+lkGKZMHAGCCsGAQUFBwEBBGQwYjAtBggrBgEFBQcwAoYhaHR0cDovL2NlcnRzLmFwcGxlLmNvbS93d2RyZzYuZGVyMDEGCCsGAQUFBzABhiVodHRwOi8vb2NzcC5hcHBsZS5jb20vb2NzcDAzLXd3ZHJnNjAyMIIBHgYDVR0gBIIBFTCCAREwggENBgoqhkiG92NkBQYBMIH+MIHDBggrBgEFBQcCAjCBtgyBs1JlbGlhbmNlIG9uIHRoaXMgY2VydGlmaWNhdGUgYnkgYW55IHBhcnR5IGFzc3VtZXMgYWNjZXB0YW5jZSBvZiB0aGUgdGhlbiBhcHBsaWNhYmxlIHN0YW5kYXJkIHRlcm1zIGFuZCBjb25kaXRpb25zIG9mIHVzZSwgY2VydGlmaWNhdGUgcG9saWN5IGFuZCBjZXJ0aWZpY2F0aW9uIHByYWN0aWNlIHN0YXRlbWVudHMuMDYGCCsGAQUFBwIBFipodHRwOi8vd3d3LmFwcGxlLmNvbS9jZXJ0aWZpY2F0ZWF1dGhvcml0eS8wHQYDVR0OBBYEFIFioG4wMMVA1ku9zJmGNPAVn3eqMA4GA1UdDwEB/wQEAwIHgDAQBgoqhkiG92NkBgsBBAIFADAKBggqhkjOPQQDAwNpADBmAjEA+qXnREC7hXIWVLsLxznjRpIzPf7VHz9V/CTm8+LJlrQepnmcPvGLNcX6XPnlcgLAAjEA5IjNZKgg5pQ79knF4IbTXdKv8vutIDMXDmjPVT3dGvFtsGRwXOywR2kZCdSrfeot";
const EFFECTIVE_DATE = new Date(1761962975000); // October 2025
const CLOCK_DATE = 41231;
class SignedJWTVerifierTest extends jws_verification_1.SignedDataVerifier {
    constructor() {
        super(...arguments);
        this.effectiveDate = EFFECTIVE_DATE;
    }
    async testVerifyCertificateChain(trustedRoots, leaf, intermediate) {
        return await this.verifyCertificateChain(trustedRoots, new crypto_1.X509Certificate(Buffer.from(leaf, 'base64')), new crypto_1.X509Certificate(Buffer.from(intermediate, 'base64')), this.effectiveDate);
    }
    async verifyCertificateChainWithoutCaching(trustedRoots, leaf, intermediate, effectiveDate) {
        return await super.verifyCertificateChainWithoutCaching(trustedRoots, leaf, intermediate, effectiveDate);
    }
    getRootCertificates() {
        return this.rootCertificates;
    }
}
describe("Chain Verification Checks", () => {
    it('should validate a chain without OCSP', async () => {
        const verifier = new SignedJWTVerifierTest([Buffer.from(ROOT_CA_BASE64_ENCODED, 'base64')], false, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        const publicKey = await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
        expect(Buffer.from(LEAF_CERT_PUBLIC_KEY_BASE64_ENCODED, 'base64')).toMatchObject(publicKey.export({
            type: 'spki',
            format: 'der'
        }));
    });
    it('should fail to validate a chain with an invalid intermediate OID', async () => {
        const verifier = new SignedJWTVerifierTest([Buffer.from(ROOT_CA_BASE64_ENCODED, 'base64')], false, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        try {
            await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_FOR_INTERMEDIATE_CA_INVALID_OID_BASE64_ENCODED, INTERMEDIATE_CA_INVALID_OID_BASE64_ENCODED);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.VERIFICATION_FAILURE);
        }
    });
    it('should fail to validate a chain with an invalid leaf OID', async () => {
        const verifier = new SignedJWTVerifierTest([Buffer.from(ROOT_CA_BASE64_ENCODED, 'base64')], false, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        try {
            await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_INVALID_OID_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.VERIFICATION_FAILURE);
        }
    });
    it('should fail to validate a chain with empty root certificate array', async () => {
        const verifier = new SignedJWTVerifierTest([], false, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        try {
            await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.VERIFICATION_FAILURE);
        }
    });
    it('should fail to validate a chain with an expired chain', async () => {
        const verifier = new SignedJWTVerifierTest([Buffer.from(ROOT_CA_BASE64_ENCODED, 'base64')], false, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        verifier.effectiveDate = new Date(2280946846000);
        try {
            await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.INVALID_CERTIFICATE);
        }
    });
    it('should validate a real chain with OCSP', async () => {
        const verifier = new SignedJWTVerifierTest([Buffer.from(REAL_APPLE_ROOT_BASE64_ENCODED, 'base64')], true, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), REAL_APPLE_SIGNING_CERTIFICATE_BASE64_ENCODED, REAL_APPLE_INTERMEDIATE_BASE64_ENCODED);
    });
    it('should fail to validate a chain with mismatched root certificates', async () => {
        const verifier = new SignedJWTVerifierTest([Buffer.from(REAL_APPLE_ROOT_BASE64_ENCODED, 'base64')], false, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        try {
            await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.VERIFICATION_FAILURE);
            return;
        }
    });
    it('should fail to validate a chain with invalid root certificates', async () => {
        try {
            const verifier = new SignedJWTVerifierTest([Buffer.from("abc", "utf-8")], false, Environment_1.Environment.PRODUCTION, "com.example", 1234);
            await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
        }
        catch (e) {
            return;
        }
        assert(false);
    });
    it('should cache OCSP responses', async () => {
        jest.useFakeTimers();
        jest.setSystemTime(CLOCK_DATE);
        const verifier = new SignedJWTVerifierTest([Buffer.from(ROOT_CA_BASE64_ENCODED, 'base64')], true, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        let spy = jest.spyOn(verifier, 'verifyCertificateChainWithoutCaching').mockImplementation((_, _2, _3, _4) => Promise.resolve(new crypto_1.X509Certificate(Buffer.from(LEAF_CERT_BASE64_ENCODED, 'base64')).publicKey));
        await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
        expect(spy).toHaveBeenCalledTimes(1);
        jest.setSystemTime(CLOCK_DATE + 1000); // 1 second
        await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
        expect(spy).toHaveBeenCalledTimes(1);
        jest.runOnlyPendingTimers();
        jest.useRealTimers();
    });
    it('should cache OCSP responses for a limited time', async () => {
        jest.useFakeTimers();
        jest.setSystemTime(CLOCK_DATE);
        const verifier = new SignedJWTVerifierTest([Buffer.from(ROOT_CA_BASE64_ENCODED, 'base64')], true, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        let spy = jest.spyOn(verifier, 'verifyCertificateChainWithoutCaching').mockImplementation((_, _2, _3, _4) => Promise.resolve(new crypto_1.X509Certificate(Buffer.from(LEAF_CERT_BASE64_ENCODED, 'base64')).publicKey));
        await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
        expect(spy).toHaveBeenCalledTimes(1);
        jest.setSystemTime(CLOCK_DATE + 15 * 60 * 1000); // 15 minutes
        await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
        expect(spy).toHaveBeenCalledTimes(2);
        jest.runOnlyPendingTimers();
        jest.useRealTimers();
    });
    it('should not return cached OCSP responses for a different chain', async () => {
        jest.useFakeTimers();
        jest.setSystemTime(CLOCK_DATE);
        const verifier = new SignedJWTVerifierTest([Buffer.from(ROOT_CA_BASE64_ENCODED, 'base64')], true, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        let spy = jest.spyOn(verifier, 'verifyCertificateChainWithoutCaching').mockImplementation((_, _2, _3, _4) => Promise.resolve(new crypto_1.X509Certificate(Buffer.from(LEAF_CERT_BASE64_ENCODED, 'base64')).publicKey));
        await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
        expect(spy).toHaveBeenCalledTimes(1);
        jest.setSystemTime(CLOCK_DATE + 15 * 60 * 1000); // 15 minutes
        await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), REAL_APPLE_SIGNING_CERTIFICATE_BASE64_ENCODED, REAL_APPLE_INTERMEDIATE_BASE64_ENCODED);
        expect(spy).toHaveBeenCalledTimes(2);
        jest.runOnlyPendingTimers();
        jest.useRealTimers();
    });
    it('should not return cached OCSP responses for a slightly different chain', async () => {
        jest.useFakeTimers();
        jest.setSystemTime(CLOCK_DATE);
        const verifier = new SignedJWTVerifierTest([Buffer.from(ROOT_CA_BASE64_ENCODED, 'base64')], true, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        let spy = jest.spyOn(verifier, 'verifyCertificateChainWithoutCaching').mockImplementation((_, _2, _3, _4) => Promise.resolve(new crypto_1.X509Certificate(Buffer.from(LEAF_CERT_BASE64_ENCODED, 'base64')).publicKey));
        await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
        expect(spy).toHaveBeenCalledTimes(1);
        jest.setSystemTime(CLOCK_DATE + 15 * 60 * 1000); // 15 minutes
        await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, REAL_APPLE_INTERMEDIATE_BASE64_ENCODED);
        expect(spy).toHaveBeenCalledTimes(2);
        jest.runOnlyPendingTimers();
        jest.useRealTimers();
    });
});
describe("Decoding checks", () => {
    it('should fail to verify with a missing x5c header', async () => {
        const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.PRODUCTION, "com.example");
        try {
            const missingX5CHeaderClaim = (0, util_1.readFile)('tests/resources/mock_signed_data/missingX5CHeaderClaim');
            await verifier.verifyAndDecodeNotification(missingX5CHeaderClaim);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.INVALID_CERTIFICATE);
        }
    });
    it('should fail to verify with an invalid bundle id', async () => {
        const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.SANDBOX, "com.example");
        try {
            const wrongBundleId = (0, util_1.readFile)('tests/resources/mock_signed_data/wrongBundleId');
            await verifier.verifyAndDecodeNotification(wrongBundleId);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.INVALID_APP_IDENTIFIER);
        }
    });
    it('should fail to verify with an invalid bundle id for transaction', async () => {
        try {
            const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.SANDBOX, "com.example.x");
            const transactionInfo = (0, util_1.readFile)('tests/resources/mock_signed_data/transactionInfo');
            await verifier.verifyAndDecodeTransaction(transactionInfo);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.INVALID_APP_IDENTIFIER);
        }
    });
    it('should fail to verify with an invalid environment', async () => {
        try {
            const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.PRODUCTION, "com.example");
            const testNotification = (0, util_1.readFile)('tests/resources/mock_signed_data/testNotification');
            const notification = await verifier.verifyAndDecodeNotification(testNotification);
            await verifier.verifyAndDecodeNotification(testNotification);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.INVALID_ENVIRONMENT);
        }
    });
    it('should fail to verify with a malformed JWT with too many parts', async () => {
        const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.SANDBOX, "com.example");
        try {
            await verifier.verifyAndDecodeNotification("a.b.c.d");
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.VERIFICATION_FAILURE);
        }
    });
    it('should fail to verify with a malformed JWT', async () => {
        const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.SANDBOX, "com.example");
        try {
            await verifier.verifyAndDecodeNotification("a.b.c");
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.VERIFICATION_FAILURE);
        }
    });
    it('should verify and decode a valid notification', async () => {
        const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.SANDBOX, "com.example");
        const testNotification = (0, util_1.readFile)('tests/resources/mock_signed_data/testNotification');
        const notification = await verifier.verifyAndDecodeNotification(testNotification);
        expect(notification.notificationType).toEqual("TEST");
    });
    it('should verify and decode a valid renewal info', async () => {
        const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.SANDBOX, "com.example");
        const renewalInfo = (0, util_1.readFile)('tests/resources/mock_signed_data/renewalInfo');
        const notification = await verifier.verifyAndDecodeRenewalInfo(renewalInfo);
        expect(notification.environment).toEqual(Environment_1.Environment.SANDBOX);
    });
    it('should verify and decode a valid transaction info', async () => {
        const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.SANDBOX, "com.example");
        const transactionInfo = (0, util_1.readFile)('tests/resources/mock_signed_data/transactionInfo');
        const notification = await verifier.verifyAndDecodeRenewalInfo(transactionInfo);
        expect(notification.environment).toEqual(Environment_1.Environment.SANDBOX);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiandzX3ZlcmlmaWNhdGlvbi50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vdGVzdHMvdW5pdC10ZXN0cy9qd3NfdmVyaWZpY2F0aW9uLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLDREQUE0RDs7QUFFNUQsaUNBQWtDO0FBQ2xDLG1DQUFvRDtBQUNwRCw2REFBdUc7QUFDdkcsMERBQXVEO0FBQ3ZELGtDQUFtSDtBQUVuSCxNQUFNLHNCQUFzQixHQUFHLDBnQkFBMGdCLENBQUM7QUFDMWlCLE1BQU0sOEJBQThCLEdBQUcsa2pCQUFrakIsQ0FBQztBQUMxbEIsTUFBTSx3QkFBd0IsR0FBRyxrakJBQWtqQixDQUFDO0FBRXBsQixNQUFNLDBDQUEwQyxHQUFHLGtqQkFBa2pCLENBQUM7QUFDdG1CLE1BQU0sd0RBQXdELEdBQUcsa2pCQUFrakIsQ0FBQztBQUNwbkIsTUFBTSxvQ0FBb0MsR0FBRyxrakJBQWtqQixDQUFDO0FBRWhtQixNQUFNLG1DQUFtQyxHQUFHLDhIQUE4SCxDQUFDO0FBRTNLLE1BQU0sOEJBQThCLEdBQUcsOHdCQUE4d0IsQ0FBQztBQUN0ekIsTUFBTSxzQ0FBc0MsR0FBRyxzaUNBQXNpQyxDQUFDO0FBQ3RsQyxNQUFNLDZDQUE2QyxHQUFHLDg1Q0FBODVDLENBQUM7QUFFcjlDLE1BQU0sY0FBYyxHQUFHLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsZUFBZTtBQUUvRCxNQUFNLFVBQVUsR0FBRyxLQUFLLENBQUE7QUFDeEIsTUFBTSxxQkFBc0IsU0FBUSxxQ0FBa0I7SUFBdEQ7O1FBQ0ksa0JBQWEsR0FBRyxjQUFjLENBQUE7SUFZbEMsQ0FBQztJQVhHLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxZQUErQixFQUFFLElBQVksRUFBRSxZQUFvQjtRQUNoRyxPQUFPLE1BQU0sSUFBSSxDQUFDLHNCQUFzQixDQUFDLFlBQVksRUFBRSxJQUFJLHdCQUFlLENBQUMsTUFBTSxDQUFD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QU8sRUFBRSxhQUFhLENBQUMsQ0FBQTtRQUVsRyxNQUFNLGVBQWUsR0FBRyxJQUFBLGVBQVEsRUFBQyxrREFBa0QsQ0FBQyxDQUFBO1FBQ3BGLE1BQU0sWUFBWSxHQUFHLE1BQU0sUUFBUSxDQUFDLDBCQUEwQixDQUFDLGVBQWUsQ0FBQyxDQUFBO1FBQy9FLE1BQU0sQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLENBQUMsT0FBTyxDQUFDLHlCQUFXLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDakUsQ0FBQyxDQUFDLENBQUE7QUFDTixDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgMjAyMyBBcHBsZSBJbmMuIExpY2Vuc2VkIHVuZGVyIE1JVCBMaWNlbnNlLlxuXG5pbXBvcnQgYXNzZXJ0ID0gcmVxdWlyZShcImFzc2VydFwiKTtcbmltcG9ydCB7IEtleU9iamVjdCwgWDUwOUNlcnRpZmljYXRlIH0gZnJvbSBcImNyeXB0b1wiO1xuaW1wb3J0IHsgU2lnbmVkRGF0YVZlcmlmaWVyLCBWZXJpZmljYXRpb25FeGNlcHRpb24sIFZlcmlmaWNhdGlvblN0YXR1cyB9IGZyb20gXCIuLi8uLi9qd3NfdmVyaWZpY2F0aW9uXCI7XG5pbXBvcnQgeyBFbnZpcm9ubWVudCB9IGZyb20gXCIuLi8uLi9tb2RlbHMvRW52aXJvbm1lbnRcIjtcbmltcG9ydCB7IHJlYWRGaWxlLCBnZXRTaWduZWRQYXlsb2FkVmVyaWZpZXJXaXRoRGVmYXVsdEFwcEFwcGxlSWQsIGdldERlZmF1bHRTaWduZWRQYXlsb2FkVmVyaWZpZXIgfSBmcm9tIFwiLi4vdXRpbFwiO1xuXG5jb25zdCBST09UX0NBX0JBU0U2NF9FTkNPREVEID0gXCJNSUlCZ2pDQ0FTbWdBd0lCQWdJSkFMVWM1QUxpSDVwYk1Bb0dDQ3FHU000OUJBTURNRFl4Q3pBSkJnTlZCQVlUQWxWVE1STXdFUVlEVlFRSURBcERZV3hwWm05eWJtbGhNUkl3RUFZRFZRUUhEQWxEZFhCbGNuUnBibTh3SGhjTk1qTXdNVEExTWpFek1ESXlXaGNOTXpNd01UQXlNakV6TURJeVdqQTJNUXN3Q1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0F3S1EyRnNhV1p2Y201cFlURVNNQkFHQTFVRUJ3d0pRM1Z3WlhKMGFXNXZNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUVjKy9CbCtnb3NwbzZ0ZjlaN2lvNXRkS2RybE4xWWRWbnFFaEVEWERTaHpkQUpQUWlqYW1YSU1IZjh4V1dUYTF6Z29ZVHhPS3BidUp0RHBsejFYcmlUYU1nTUI0d0RBWURWUjBUQkFVd0F3RUIvekFPQmdOVkhROEJBZjhFQkFNQ0FRWXdDZ1lJS29aSXpqMEVBd01EUndBd1JBSWdlbVdRWG5NQWRUYWQySkRKV25nOVU0dUJCTDVtQTdXSTA1SDdvSDdjNmlRQ0lIaVJxTWpOZnpVQXlpdTloNnJPVS9LK2lUUjBJLzNZL05TV3NYSFgrYWNjXCI7XG5jb25zdCBJTlRFUk1FRElBVEVfQ0FfQkFTRTY0X0VOQ09ERUQgPSBcIk1JSUJuekNDQVVXZ0F3SUJBZ0lCQ3pBS0JnZ3Foa2pPUFFRREF6QTJNUXN3Q1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0F3S1EyRnNhV1p2Y201cFlURVNNQkFHQTFVRUJ3d0pRM1Z3WlhKMGFXNXZNQjRYRFRJek1ERXdOVEl4TXpFd05Wb1hEVE16TURFd01USXhNekV3TlZvd1JURUxNQWtHQTFVRUJoTUNWVk14Q3pBSkJnTlZCQWdNQWtOQk1SSXdFQVlEVlFRSERBbERkWEJsY25ScGJtOHhGVEFUQmdOVkJBb01ERWx1ZEdWeWJXVmthV0YwWlRCWk1CTUdCeXFHU000OUFnRUdDQ3FHU000OUF3RUhBMElBQkJVTjVWOXJLamZSaU1BSW9qRUEwQXY1TXAwb0YrTzBjTDRnenJURjE3OGluVUh1Z2o3RXQ0Nk5ya1E3aEtnTVZuam9ncTQ1UTFyTXMrY01IVk5JTFdxak5UQXpNQThHQTFVZEV3UUlNQVlCQWY4Q0FRQXdEZ1lEVlIwUEFRSC9CQVFEQWdFR01CQUdDaXFHU0liM1kyUUdBZ0VFQWdVQU1Bb0dDQ3FHU000OUJBTURBMGdBTUVVQ0lRQ21zSUtZczQxdWxsc3NIWDRyVnZlVVQwWjdJczUvaExLMWxGUFR0dW4zaEFJZ2MyKzJSRzUrZ05jRlZjcytYSmVFbDRHWitvamwzUk9PbWxsK3llN2R5blE9XCI7XG5jb25zdCBMRUFGX0NFUlRfQkFTRTY0X0VOQ09ERUQgPSBcIk1JSUJvRENDQVVhZ0F3SUJBZ0lCRERBS0JnZ3Foa2pPUFFRREF6QkZNUXN3Q1FZRFZRUUdFd0pWVXpFTE1Ba0dBMVVFQ0F3Q1EwRXhFakFRQmdOVkJBY01DVU4xY0dWeWRHbHViekVWTUJNR0ExVUVDZ3dNU1c1MFpYSnRaV1JwWVhSbE1CNFhEVEl6TURFd05USXhNekV6TkZvWERUTXpNREV3TVRJeE16RXpORm93UFRFTE1Ba0dBMVVFQmhNQ1ZWTXhDekFKQmdOVkJBZ01Ba05CTVJJd0VBWURWUVFIREFsRGRYQmxjblJwYm04eERUQUxCZ05WQkFvTUJFeGxZV1l3V1RBVEJnY3Foa2pPUFFJQkJnZ3Foa2pPUFFNQkJ3TkNBQVRpdFlIRWFZVnVjOGc5QWpUT3dFck12R3lQeWtQYStwdXZUSThoSlRIWlpETEdhczJxWDErRXJ4Z1FUSmdWWHY3Nm5tTGhoUkpIK2oyNUFpQUk4aUdzb3k4d0xUQUpCZ05WSFJNRUFqQUFNQTRHQTFVZER3RUIvd1FFQXdJSGdEQVFCZ29xaGtpRzkyTmtCZ3NCQkFJRkFEQUtCZ2dxaGtqT1BRUURBd05JQURCRkFpQlg0YytUMEZwNW5KNVFSQ2xSZnU1UFNCeVJ2TlB0dWFUc2swdlBCM1dBSUFJaEFOZ2FhdUFqL1lQOXMwQWtFaHlKaHhRTy82UTJ6b3VaK0gxQ0lPZWhuTXpRXCI7ICAgIFxuXG5jb25zdCBJTlRFUk1FRElBVEVfQ0FfSU5WQUxJRF9PSURfQkFTRTY0X0VOQ09ERUQgPSBcIk1JSUJuakNDQVVXZ0F3SUJBZ0lCRFRBS0JnZ3Foa2pPUFFRREF6QTJNUXN3Q1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0F3S1EyRnNhV1p2Y201cFlURVNNQkFHQTFVRUJ3d0pRM1Z3WlhKMGFXNXZNQjRYRFRJek1ERXdOVEl4TXpZeE5Gb1hEVE16TURFd01USXhNell4TkZvd1JURUxNQWtHQTFVRUJoTUNWVk14Q3pBSkJnTlZCQWdNQWtOQk1SSXdFQVlEVlFRSERBbERkWEJsY25ScGJtOHhGVEFUQmdOVkJBb01ERWx1ZEdWeWJXVmthV0YwWlRCWk1CTUdCeXFHU000OUFnRUdDQ3FHU000OUF3RUhBMElBQkJVTjVWOXJLamZSaU1BSW9qRUEwQXY1TXAwb0YrTzBjTDRnenJURjE3OGluVUh1Z2o3RXQ0Nk5ya1E3aEtnTVZuam9ncTQ1UTFyTXMrY01IVk5JTFdxak5UQXpNQThHQTFVZEV3UUlNQVlCQWY4Q0FRQXdEZ1lEVlIwUEFRSC9CQVFEQWdFR01CQUdDaXFHU0liM1kyUUdBZ0lFQWdVQU1Bb0dDQ3FHU000OUJBTURBMGNBTUVRQ0lGUk90VEUrUlFwS3hOWEVURnNmN01jMGgrNUlBc3h4by9YNm9DQy9jMzNxQWlBbUM1cm41eUNPT0VqVFk0UjFIMVFjUVZoK2VVd0NsMTNOYlF4V0N1d3h4QT09XCI7XG5jb25zdCBMRUFGX0NFUlRfRk9SX0lOVEVSTUVESUFURV9DQV9JTlZBTElEX09JRF9CQVNFNjRfRU5DT0RFRCA9IFwiTUlJQm56Q0NBVWFnQXdJQkFnSUJEakFLQmdncWhrak9QUVFEQXpCRk1Rc3dDUVlEVlFRR0V3SlZVekVMTUFrR0ExVUVDQXdDUTBFeEVqQVFCZ05WQkFjTUNVTjFjR1Z5ZEdsdWJ6RVZNQk1HQTFVRUNnd01TVzUwWlhKdFpXUnBZWFJsTUI0WERUSXpNREV3TlRJeE16WTFPRm9YRFRNek1ERXdNVEl4TXpZMU9Gb3dQVEVMTUFrR0ExVUVCaE1DVlZNeEN6QUpCZ05WQkFnTUFrTkJNUkl3RUFZRFZRUUhEQWxEZFhCbGNuUnBibTh4RFRBTEJnTlZCQW9NQkV4bFlXWXdXVEFUQmdjcWhrak9QUUlCQmdncWhrak9QUU1CQndOQ0FBVGl0WUhFYVlWdWM4ZzlBalRPd0VyTXZHeVB5a1BhK3B1dlRJOGhKVEhaWkRMR2FzMnFYMStFcnhnUVRKZ1ZYdjc2bm1MaGhSSkgrajI1QWlBSThpR3NveTh3TFRBSkJnTlZIUk1FQWpBQU1BNEdBMVVkRHdFQi93UUVBd0lIZ0RBUUJnb3Foa2lHOTJOa0Jnc0JCQUlGQURBS0JnZ3Foa2pPUFFRREF3TkhBREJFQWlBVUFzK2d6WU9zRVhEd1FxdXZIWWJjVnlteU5xRHRHdzlCblVGcDJZTHV1QUlnWHhRM0llOVlVMGNNcWtlYUZkK2x5bzBhc3Y5ZXl6azZzdHdqZUllT3RUVT1cIjtcbmNvbnN0IExFQUZfQ0VSVF9JTlZBTElEX09JRF9CQVNFNjRfRU5DT0RFRCA9IFwiTUlJQm9EQ0NBVWFnQXdJQkFnSUJEekFLQmdncWhrak9QUVFEQXpCRk1Rc3dDUVlEVlFRR0V3SlZVekVMTUFrR0ExVUVDQXdDUTBFeEVqQVFCZ05WQkFjTUNVTjFjR1Z5ZEdsdWJ6RVZNQk1HQTFVRUNnd01TVzUwWlhKdFpXUnBZWFJsTUI0WERUSXpNREV3TlRJeE16Y3pNVm9YRFRNek1ERXdNVEl4TXpjek1Wb3dQVEVMTUFrR0ExVUVCaE1DVlZNeEN6QUpCZ05WQkFnTUFrTkJNUkl3RUFZRFZRUUhEQWxEZFhCbGNuUnBibTh4RFRBTEJnTlZCQW9NQkV4bFlXWXdXVEFUQmdjcWhrak9QUUlCQmdncWhrak9QUU1CQndOQ0FBVGl0WUhFYVlWdWM4ZzlBalRPd0VyTXZHeVB5a1BhK3B1dlRJOGhKVEhaWkRMR2FzMnFYMStFcnhnUVRKZ1ZYdjc2bm1MaGhSSkgrajI1QWlBSThpR3NveTh3TFRBSkJnTlZIUk1FQWpBQU1BNEdBMVVkRHdFQi93UUVBd0lIZ0RBUUJnb3Foa2lHOTJOa0Jnc0NCQUlGQURBS0JnZ3Foa2pPUFFRREF3TklBREJGQWlBYis3UzNpLy9iU0d5N3NrSlk5K0Q0VmdjUUxLRmVZZklNU3JVQ21kckZxd0loQUlNVnd6RDFScnhQUnRKeWlPQ1hMeWliSXZ3Y1krVlM3M0hZZmswTzlsZ3pcIjtcblxuY29uc3QgTEVBRl9DRVJUX1BVQkxJQ19LRVlfQkFTRTY0X0VOQ09ERUQgPSBcIk1Ga3dFd1lIS29aSXpqMENBUVlJS29aSXpqMERBUWNEUWdBRTRyV0J4R21GYm5QSVBRSTB6c0JLekx4c2o4cEQydnFicjB5UElTVXgyV1F5eG1yTnFsOWZoSzhZRUV5WUZWNysrcDVpNFlVU1Ivbzl1UUlnQ1BJaHJBPT1cIjtcblxuY29uc3QgUkVBTF9BUFBMRV9ST09UX0JBU0U2NF9FTkNPREVEID0gXCJNSUlDUXpDQ0FjbWdBd0lCQWdJSUxjWDhpTkxGUzVVd0NnWUlLb1pJemowRUF3TXdaekViTUJrR0ExVUVBd3dTUVhCd2JHVWdVbTl2ZENCRFFTQXRJRWN6TVNZd0pBWURWUVFMREIxQmNIQnNaU0JEWlhKMGFXWnBZMkYwYVc5dUlFRjFkR2h2Y21sMGVURVRNQkVHQTFVRUNnd0tRWEJ3YkdVZ1NXNWpMakVMTUFrR0ExVUVCaE1DVlZNd0hoY05NVFF3TkRNd01UZ3hPVEEyV2hjTk16a3dORE13TVRneE9UQTJXakJuTVJzd0dRWURWUVFEREJKQmNIQnNaU0JTYjI5MElFTkJJQzBnUnpNeEpqQWtCZ05WQkFzTUhVRndjR3hsSUVObGNuUnBabWxqWVhScGIyNGdRWFYwYUc5eWFYUjVNUk13RVFZRFZRUUtEQXBCY0hCc1pTQkpibU11TVFzd0NRWURWUVFHRXdKVlV6QjJNQkFHQnlxR1NNNDlBZ0VHQlN1QkJBQWlBMklBQkpqcEx6MUFjcVR0a3lKeWdSTWMzUkNWOGNXalRuSGNGQmJaRHVXbUJTcDNaSHRmVGpqVHV4eEV0WC8xSDdZeVlsM0o2WVJiVHpCUEVWb0EvVmhZREtYMUR5eE5CMGNUZGRxWGw1ZHZNVnp0SzUxN0lEdll1VlRaWHBta09sRUtNYU5DTUVBd0hRWURWUjBPQkJZRUZMdXczcUZZTTRpYXBJcVozcjY5NjYvYXl5U3JNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHdEZ1lEVlIwUEFRSC9CQVFEQWdFR01Bb0dDQ3FHU000OUJBTURBMmdBTUdVQ01RQ0Q2Y0hFRmw0YVhUUVkyZTN2OUd3T0FFWkx1Tit5UmhIRkQvM21lb3locG12T3dnUFVuUFdUeG5TNGF0K3FJeFVDTUcxbWloREsxQTNVVDgyTlF6NjBpbU9sTTI3amJkb1h0MlFmeUZNbStZaGlkRGtMRjF2TFVhZ002QmdENTZLeUtBPT1cIjtcbmNvbnN0IFJFQUxfQVBQTEVfSU5URVJNRURJQVRFX0JBU0U2NF9FTkNPREVEID0gXCJNSUlERmpDQ0FweWdBd0lCQWdJVUlzR2hSd3AwYzJudlU0WVN5Y2FmUFRqemJOY3dDZ1lJS29aSXpqMEVBd013WnpFYk1Ca0dBMVVFQXd3U1FYQndiR1VnVW05dmRDQkRRU0F0SUVjek1TWXdKQVlEVlFRTERCMUJjSEJzWlNCRFpYSjBhV1pwWTJGMGFXOXVJRUYxZEdodmNtbDBlVEVUTUJFR0ExVUVDZ3dLUVhCd2JHVWdTVzVqTGpFTE1Ba0dBMVVFQmhNQ1ZWTXdIaGNOTWpFd016RTNNakF6TnpFd1doY05Nell3TXpFNU1EQXdNREF3V2pCMU1VUXdRZ1lEVlFRREREdEJjSEJzWlNCWGIzSnNaSGRwWkdVZ1JHVjJaV3h2Y0dWeUlGSmxiR0YwYVc5dWN5QkRaWEowYVdacFkyRjBhVzl1SUVGMWRHaHZjbWwwZVRFTE1Ba0dBMVVFQ3d3Q1J6WXhFekFSQmdOVkJBb01Da0Z3Y0d4bElFbHVZeTR4Q3pBSkJnTlZCQVlUQWxWVE1IWXdFQVlIS29aSXpqMENBUVlGSzRFRUFDSURZZ0FFYnNRS0M5NFBybFdtWlhuWGd0eHpkVkpMOFQwU0dZbmdEUkdwbmduM042UFQ4Sk1FYjdGRGk0YkJtUGhDblozL3NxNlBGL2NHY0tYV3NMNXZPdGVSaHlKNDV4M0FTUDdjT0IrYWFvOTBmY3B4U3YvRVpGYm5pQWJOZ1pHaElocElvNEg2TUlIM01CSUdBMVVkRXdFQi93UUlNQVlCQWY4Q0FRQXdId1lEVlIwakJCZ3dGb0FVdTdEZW9WZ3ppSnFraXBuZXZyM3JyOXJMSktzd1JnWUlLd1lCQlFVSEFRRUVPakE0TURZR0NDc0dBUVVGQnpBQmhpcG9kSFJ3T2k4dmIyTnpjQzVoY0hCc1pTNWpiMjB2YjJOemNEQXpMV0Z3Y0d4bGNtOXZkR05oWnpNd053WURWUjBmQkRBd0xqQXNvQ3FnS0lZbWFIUjBjRG92TDJOeWJDNWhjSEJzWlM1amIyMHZZWEJ3YkdWeWIyOTBZMkZuTXk1amNtd3dIUVlEVlIwT0JCWUVGRDh2bENOUjAxREptaWc5N2JCODVjK2xrR0taTUE0R0ExVWREd0VCL3dRRUF3SUJCakFRQmdvcWhraUc5Mk5rQmdJQkJBSUZBREFLQmdncWhrak9QUVFEQXdOb0FEQmxBakJBWGhTcTVJeUtvZ01DUHR3NDkwQmFCNjc3Q2FFR0pYdWZRQi9FcVpHZDZDU2ppQ3RPbnVNVGJYVlhteHhjeGZrQ01RRFRTUHhhclpYdk5ya3hVM1RrVU1JMzN5enZGVlZSVDR3eFdKQzk5NE9zZGNaNCtSR05zWUR5UjVnbWRyMG5ER2c9XCI7XG5jb25zdCBSRUFMX0FQUExFX1NJR05JTkdfQ0VSVElGSUNBVEVfQkFTRTY0X0VOQ09ERUQgPSBcIk1JSUVNVENDQTdhZ0F3SUJBZ0lRUjhLSHpkbjU1NFovVW9yYWROeDl0ekFLQmdncWhrak9QUVFEQXpCMU1VUXdRZ1lEVlFRREREdEJjSEJzWlNCWGIzSnNaSGRwWkdVZ1JHVjJaV3h2Y0dWeUlGSmxiR0YwYVc5dWN5QkRaWEowYVdacFkyRjBhVzl1SUVGMWRHaHZjbWwwZVRFTE1Ba0dBMVVFQ3d3Q1J6WXhFekFSQmdOVkJBb01Da0Z3Y0d4bElFbHVZeTR4Q3pBSkJnTlZCQVlUQWxWVE1CNFhEVEkxTURreE9URTVORFExTVZvWERUSTNNVEF4TXpFM05EY3lNMW93Z1pJeFFEQStCZ05WQkFNTU4xQnliMlFnUlVORElFMWhZeUJCY0hBZ1UzUnZjbVVnWVc1a0lHbFVkVzVsY3lCVGRHOXlaU0JTWldObGFYQjBJRk5wWjI1cGJtY3hMREFxQmdOVkJBc01JMEZ3Y0d4bElGZHZjbXhrZDJsa1pTQkVaWFpsYkc5d1pYSWdVbVZzWVhScGIyNXpNUk13RVFZRFZRUUtEQXBCY0hCc1pTQkpibU11TVFzd0NRWURWUVFHRXdKVlV6QlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJOblZ2aGN2N2lUKzdFeDV0Qk1CZ3JRc3BIeklzWFJpMFl4ZmVrN2x2OHdFbWovYkhpV3ROd0pxYzJCb0h6c1FpRWpQN0tGSUlLZzRZOHkwL255bnVBbWpnZ0lJTUlJQ0JEQU1CZ05WSFJNQkFmOEVBakFBTUI4R0ExVWRJd1FZTUJhQUZEOHZsQ05SMDFESm1pZzk3YkI4NWMrbGtHS1pNSEFHQ0NzR0FRVUZCd0VCQkdRd1lqQXRCZ2dyQmdFRkJRY3dBb1loYUhSMGNEb3ZMMk5sY25SekxtRndjR3hsTG1OdmJTOTNkMlJ5WnpZdVpHVnlNREVHQ0NzR0FRVUZCekFCaGlWb2RIUndPaTh2YjJOemNDNWhjSEJzWlM1amIyMHZiMk56Y0RBekxYZDNaSEpuTmpBeU1JSUJIZ1lEVlIwZ0JJSUJGVENDQVJFd2dnRU5CZ29xaGtpRzkyTmtCUVlCTUlIK01JSERCZ2dyQmdFRkJRY0NBakNCdGd5QnMxSmxiR2xoYm1ObElHOXVJSFJvYVhNZ1kyVnlkR2xtYVdOaGRHVWdZbmtnWVc1NUlIQmhjblI1SUdGemMzVnRaWE1nWVdOalpYQjBZVzVqWlNCdlppQjBhR1VnZEdobGJpQmhjSEJzYVdOaFlteGxJSE4wWVc1a1lYSmtJSFJsY20xeklHRnVaQ0JqYjI1a2FYUnBiMjV6SUc5bUlIVnpaU3dnWTJWeWRHbG1hV05oZEdVZ2NHOXNhV041SUdGdVpDQmpaWEowYVdacFkyRjBhVzl1SUhCeVlXTjBhV05sSUhOMFlYUmxiV1Z1ZEhNdU1EWUdDQ3NHQVFVRkJ3SUJGaXBvZEhSd09pOHZkM2QzTG1Gd2NHeGxMbU52YlM5alpYSjBhV1pwWTJGMFpXRjFkR2h2Y21sMGVTOHdIUVlEVlIwT0JCWUVGSUZpb0c0d01NVkExa3U5ekptR05QQVZuM2VxTUE0R0ExVWREd0VCL3dRRUF3SUhnREFRQmdvcWhraUc5Mk5rQmdzQkJBSUZBREFLQmdncWhrak9QUVFEQXdOcEFEQm1BakVBK3FYblJFQzdoWElXVkxzTHh6bmpScEl6UGY3Vkh6OVYvQ1RtOCtMSmxyUWVwbm1jUHZHTE5jWDZYUG5sY2dMQUFqRUE1SWpOWktnZzVwUTc5a25GNEliVFhkS3Y4dnV0SURNWERtalBWVDNkR3ZGdHNHUndYT3l3UjJrWkNkU3JmZW90XCI7XG5cbmNvbnN0IEVGRkVDVElWRV9EQVRFID0gbmV3IERhdGUoMTc2MTk2Mjk3NTAwMCk7IC8vIE9jdG9iZXIgMjAyNVxuXG5jb25zdCBDTE9DS19EQVRFID0gNDEyMzFcbmNsYXNzIFNpZ25lZEpXVFZlcmlmaWVyVGVzdCBleHRlbmRzIFNpZ25lZERhdGFWZXJpZmllciB7XG4gICAgZWZmZWN0aXZlRGF0ZSA9IEVGRkVDVElWRV9EQVRFXG4gICAgYXN5bmMgdGVzdFZlcmlmeUNlcnRpZmljYXRlQ2hhaW4odHJ1c3RlZFJvb3RzOiBYNTA5Q2VydGlmaWNhdGVbXSwgbGVhZjogc3RyaW5nLCBpbnRlcm1lZGlhdGU6IHN0cmluZyk6IFByb21pc2U8S2V5T2JqZWN0PiB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnZlcmlmeUNlcnRpZmljYXRlQ2hhaW4odHJ1c3RlZFJvb3RzLCBuZXcgWDUwOUNlcnRpZmljYXRlKEJ1ZmZlci5mcm9tKGxlYWYsICdiYXNlNjQnKSksIG5ldyBYNTA5Q2VydGlmaWNhdGUoQnVmZmVyLmZyb20oaW50ZXJtZWRpYXRlLCAnYmFzZTY0JykpLCB0aGlzLmVmZmVjdGl2ZURhdGUpXG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIHZlcmlmeUNlcnRpZmljYXRlQ2hhaW5XaXRob3V0Q2FjaGluZyh0cnVzdGVkUm9vdHM6IFg1MDlDZXJ0aWZpY2F0ZVtdLCBsZWFmOiBYNTA5Q2VydGlmaWNhdGUsIGludGVybWVkaWF0ZTogWDUwOUNlcnRpZmljYXRlLCBlZmZlY3RpdmVEYXRlOiBEYXRlKTogUHJvbWlzZTxLZXlPYmplY3Q+IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHN1cGVyLnZlcmlmeUNlcnRpZmljYXRlQ2hhaW5XaXRob3V0Q2FjaGluZyh0cnVzdGVkUm9vdHMsIGxlYWYsIGludGVybWVkaWF0ZSwgZWZmZWN0aXZlRGF0ZSlcbiAgICB9XG5cbiAgICBnZXRSb290Q2VydGlmaWNhdGVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb290Q2VydGlmaWNhdGVzXG4gICAgfSBcbn1cblxuZGVzY3JpYmUoXCJDaGFpbiBWZXJpZmljYXRpb24gQ2hlY2tzXCIsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGEgY2hhaW4gd2l0aG91dCBPQ1NQJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB2ZXJpZmllciA9IG5ldyBTaWduZWRKV1RWZXJpZmllclRlc3QoW0J1ZmZlci5mcm9tKFJPT1RfQ0FfQkFTRTY0X0VOQ09ERUQsICdiYXNlNjQnKV0sIGZhbHNlLCBFbnZpcm9ubWVudC5QUk9EVUNUSU9OLCBcImNvbS5leGFtcGxlXCIsIDEyMzQpO1xuICAgICAgICBjb25zdCBwdWJsaWNLZXkgPSBhd2FpdCB2ZXJpZmllci50ZXN0VmVyaWZ5Q2VydGlmaWNhdGVDaGFpbih2ZXJpZmllci5nZXRSb290Q2VydGlmaWNhdGVzKCksIExFQUZfQ0VSVF9CQVNFNjRfRU5DT0RFRCwgSU5URVJNRURJQVRFX0NBX0JBU0U2NF9FTkNPREVEKVxuICAgICAgICBleHBlY3QoQnVmZmVyLmZyb20oTEVBRl9DRVJUX1BVQkxJQ19LRVlfQkFTRTY0X0VOQ09ERUQsICdiYXNlNjQnKSkudG9NYXRjaE9iamVjdChwdWJsaWNLZXkuZXhwb3J0KHtcbiAgICAgICAgICAgIHR5cGU6ICdzcGtpJyxcbiAgICAgICAgICAgIGZvcm1hdDogJ2RlcidcbiAgICAgICAgfSkpXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgZmFpbCB0byB2YWxpZGF0ZSBhIGNoYWluIHdpdGggYW4gaW52YWxpZCBpbnRlcm1lZGlhdGUgT0lEJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB2ZXJpZmllciA9IG5ldyBTaWduZWRKV1RWZXJpZmllclRlc3QoW0J1ZmZlci5mcm9tKFJPT1RfQ0FfQkFTRTY0X0VOQ09ERUQsICdiYXNlNjQnKV0sIGZhbHNlLCBFbnZpcm9ubWVudC5QUk9EVUNUSU9OLCBcImNvbS5leGFtcGxlXCIsIDEyMzQpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdmVyaWZpZXIudGVzdFZlcmlmeUNlcnRpZmljYXRlQ2hhaW4odmVyaWZpZXIuZ2V0Um9vdENlcnRpZmljYXRlcygpLCBMRUFGX0NFUlRfRk9SX0lOVEVSTUVESUFURV9DQV9JTlZBTElEX09JRF9CQVNFNjRfRU5DT0RFRCwgSU5URVJNRURJQVRFX0NBX0lOVkFMSURfT0lEX0JBU0U2NF9FTkNPREVEKVxuICAgICAgICAgICAgYXNzZXJ0KGZhbHNlKVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBleHBlY3QoZSkudG9CZUluc3RhbmNlT2YoVmVyaWZpY2F0aW9uRXhjZXB0aW9uKVxuICAgICAgICAgICAgZXhwZWN0KChlIGFzIFZlcmlmaWNhdGlvbkV4Y2VwdGlvbikuc3RhdHVzKS50b0VxdWFsKFZlcmlmaWNhdGlvblN0YXR1cy5WRVJJRklDQVRJT05fRkFJTFVSRSlcbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIGZhaWwgdG8gdmFsaWRhdGUgYSBjaGFpbiB3aXRoIGFuIGludmFsaWQgbGVhZiBPSUQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHZlcmlmaWVyID0gbmV3IFNpZ25lZEpXVFZlcmlmaWVyVGVzdChbQnVmZmVyLmZyb20oUk9PVF9DQV9CQVNFNjRfRU5DT0RFRCwgJ2Jhc2U2NCcpXSwgZmFsc2UsIEVudmlyb25tZW50LlBST0RVQ1RJT04sIFwiY29tLmV4YW1wbGVcIiwgMTIzNCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB2ZXJpZmllci50ZXN0VmVyaWZ5Q2VydGlmaWNhdGVDaGFpbih2ZXJpZmllci5nZXRSb290Q2VydGlmaWNhdGVzKCksIExFQUZfQ0VSVF9JTlZBTElEX09JRF9CQVNFNjRfRU5DT0RFRCwgSU5URVJNRURJQVRFX0NBX0JBU0U2NF9FTkNPREVEKVxuICAgICAgICAgICAgYXNzZXJ0KGZhbHNlKVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBleHBlY3QoZSkudG9CZUluc3RhbmNlT2YoVmVyaWZpY2F0aW9uRXhjZXB0aW9uKVxuICAgICAgICAgICAgZXhwZWN0KChlIGFzIFZlcmlmaWNhdGlvbkV4Y2VwdGlvbikuc3RhdHVzKS50b0VxdWFsKFZlcmlmaWNhdGlvblN0YXR1cy5WRVJJRklDQVRJT05fRkFJTFVSRSlcbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIGZhaWwgdG8gdmFsaWRhdGUgYSBjaGFpbiB3aXRoIGVtcHR5IHJvb3QgY2VydGlmaWNhdGUgYXJyYXknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHZlcmlmaWVyID0gbmV3IFNpZ25lZEpXVFZlcmlmaWVyVGVzdChbXSwgZmFsc2UsIEVudmlyb25tZW50LlBST0RVQ1RJT04sIFwiY29tLmV4YW1wbGVcIiwgMTIzNCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB2ZXJpZmllci50ZXN0VmVyaWZ5Q2VydGlmaWNhdGVDaGFpbih2ZXJpZmllci5nZXRSb290Q2VydGlmaWNhdGVzKCksIExFQUZfQ0VSVF9CQVNFNjRfRU5DT0RFRCwgSU5URVJNRURJQVRFX0NBX0JBU0U2NF9FTkNPREVEKVxuICAgICAgICAgICAgYXNzZXJ0KGZhbHNlKVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBleHBlY3QoZSkudG9CZUluc3RhbmNlT2YoVmVyaWZpY2F0aW9uRXhjZXB0aW9uKVxuICAgICAgICAgICAgZXhwZWN0KChlIGFzIFZlcmlmaWNhdGlvbkV4Y2VwdGlvbikuc3RhdHVzKS50b0VxdWFsKFZlcmlmaWNhdGlvblN0YXR1cy5WRVJJRklDQVRJT05fRkFJTFVSRSlcbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIGZhaWwgdG8gdmFsaWRhdGUgYSBjaGFpbiB3aXRoIGFuIGV4cGlyZWQgY2hhaW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHZlcmlmaWVyID0gbmV3IFNpZ25lZEpXVFZlcmlmaWVyVGVzdChbQnVmZmVyLmZyb20oUk9PVF9DQV9CQVNFNjRfRU5DT0RFRCwgJ2Jhc2U2NCcpXSwgZmFsc2UsIEVudmlyb25tZW50LlBST0RVQ1RJT04sIFwiY29tLmV4YW1wbGVcIiwgMTIzNCk7XG4gICAgICAgIHZlcmlmaWVyLmVmZmVjdGl2ZURhdGUgPSBuZXcgRGF0ZSgyMjgwOTQ2ODQ2MDAwKVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdmVyaWZpZXIudGVzdFZlcmlmeUNlcnRpZmljYXRlQ2hhaW4odmVyaWZpZXIuZ2V0Um9vdENlcnRpZmljYXRlcygpLCBMRUFGX0NFUlRfQkFTRTY0X0VOQ09ERUQsIElOVEVSTUVESUFURV9DQV9CQVNFNjRfRU5DT0RFRClcbiAgICAgICAgICAgIGFzc2VydChmYWxzZSlcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgZXhwZWN0KGUpLnRvQmVJbnN0YW5jZU9mKFZlcmlmaWNhdGlvbkV4Y2VwdGlvbilcbiAgICAgICAgICAgIGV4cGVjdCgoZSBhcyBWZXJpZmljYXRpb25FeGNlcHRpb24pLnN0YXR1cykudG9FcXVhbChWZXJpZmljYXRpb25TdGF0dXMuSU5WQUxJRF9DRVJUSUZJQ0FURSlcbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGEgcmVhbCBjaGFpbiB3aXRoIE9DU1AnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHZlcmlmaWVyID0gbmV3IFNpZ25lZEpXVFZlcmlmaWVyVGVzdChbQnVmZmVyLmZyb20oUkVBTF9BUFBMRV9ST09UX0JBU0U2NF9FTkNPREVELCAnYmFzZTY0JyldLCB0cnVlLCBFbnZpcm9ubWVudC5QUk9EVUNUSU9OLCBcImNvbS5leGFtcGxlXCIsIDEyMzQpO1xuICAgICAgICBhd2FpdCB2ZXJpZmllci50ZXN0VmVyaWZ5Q2VydGlmaWNhdGVDaGFpbih2ZXJpZmllci5nZXRSb290Q2VydGlmaWNhdGVzKCksIFJFQUxfQVBQTEVfU0lHTklOR19DRVJUSUZJQ0FURV9CQVNFNjRfRU5DT0RFRCwgUkVBTF9BUFBMRV9JTlRFUk1FRElBVEVfQkFTRTY0X0VOQ09ERUQpXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgZmFpbCB0byB2YWxpZGF0ZSBhIGNoYWluIHdpdGggbWlzbWF0Y2hlZCByb290IGNlcnRpZmljYXRlcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdmVyaWZpZXIgPSBuZXcgU2lnbmVkSldUVmVyaWZpZXJUZXN0KFtCdWZmZXIuZnJvbShSRUFMX0FQUExFX1JPT1RfQkFTRTY0X0VOQ09ERUQsICdiYXNlNjQnKV0sIGZhbHNlLCBFbnZpcm9ubWVudC5QUk9EVUNUSU9OLCBcImNvbS5leGFtcGxlXCIsIDEyMzQpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdmVyaWZpZXIudGVzdFZlcmlmeUNlcnRpZmljYXRlQ2hhaW4odmVyaWZpZXIuZ2V0Um9vdENlcnRpZmljYXRlcygpLCBMRUFGX0NFUlRfQkFTRTY0X0VOQ09ERUQsIElOVEVSTUVESUFURV9DQV9CQVNFNjRfRU5DT0RFRClcbiAgICAgICAgICAgIGFzc2VydChmYWxzZSlcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgZXhwZWN0KGUpLnRvQmVJbnN0YW5jZU9mKFZlcmlmaWNhdGlvbkV4Y2VwdGlvbilcbiAgICAgICAgICAgIGV4cGVjdCgoZSBhcyBWZXJpZmljYXRpb25FeGNlcHRpb24pLnN0YXR1cykudG9FcXVhbChWZXJpZmljYXRpb25TdGF0dXMuVkVSSUZJQ0FUSU9OX0ZBSUxVUkUpXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIGZhaWwgdG8gdmFsaWRhdGUgYSBjaGFpbiB3aXRoIGludmFsaWQgcm9vdCBjZXJ0aWZpY2F0ZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB2ZXJpZmllciA9IG5ldyBTaWduZWRKV1RWZXJpZmllclRlc3QoW0J1ZmZlci5mcm9tKFwiYWJjXCIsIFwidXRmLThcIildLCBmYWxzZSwgRW52aXJvbm1lbnQuUFJPRFVDVElPTiwgXCJjb20uZXhhbXBsZVwiLCAxMjM0KTtcbiAgICAgICAgICAgIGF3YWl0IHZlcmlmaWVyLnRlc3RWZXJpZnlDZXJ0aWZpY2F0ZUNoYWluKHZlcmlmaWVyLmdldFJvb3RDZXJ0aWZpY2F0ZXMoKSwgTEVBRl9DRVJUX0JBU0U2NF9FTkNPREVELCBJTlRFUk1FRElBVEVfQ0FfQkFTRTY0X0VOQ09ERUQpXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICAgIGFzc2VydChmYWxzZSlcbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCBjYWNoZSBPQ1NQIHJlc3BvbnNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgamVzdC51c2VGYWtlVGltZXJzKClcbiAgICAgICAgamVzdC5zZXRTeXN0ZW1UaW1lKENMT0NLX0RBVEUpXG4gICAgICAgIGNvbnN0IHZlcmlmaWVyID0gbmV3IFNpZ25lZEpXVFZlcmlmaWVyVGVzdChbQnVmZmVyLmZyb20oUk9PVF9DQV9CQVNFNjRfRU5DT0RFRCwgJ2Jhc2U2NCcpXSwgdHJ1ZSwgRW52aXJvbm1lbnQuUFJPRFVDVElPTiwgXCJjb20uZXhhbXBsZVwiLCAxMjM0KTtcbiAgICAgICAgbGV0IHNweSA9IGplc3Quc3B5T24odmVyaWZpZXIsICd2ZXJpZnlDZXJ0aWZpY2F0ZUNoYWluV2l0aG91dENhY2hpbmcnKS5tb2NrSW1wbGVtZW50YXRpb24oKF8sIF8yLCBfMywgXzQpID0+IFByb21pc2UucmVzb2x2ZShuZXcgWDUwOUNlcnRpZmljYXRlKEJ1ZmZlci5mcm9tKExFQUZfQ0VSVF9CQVNFNjRfRU5DT0RFRCwgJ2Jhc2U2NCcpKS5wdWJsaWNLZXkpKTtcbiAgICAgICAgYXdhaXQgdmVyaWZpZXIudGVzdFZlcmlmeUNlcnRpZmljYXRlQ2hhaW4odmVyaWZpZXIuZ2V0Um9vdENlcnRpZmljYXRlcygpLCBMRUFGX0NFUlRfQkFTRTY0X0VOQ09ERUQsIElOVEVSTUVESUFURV9DQV9CQVNFNjRfRU5DT0RFRClcbiAgICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgICBqZXN0LnNldFN5c3RlbVRpbWUoQ0xPQ0tfREFURSArIDFfMDAwKSAvLyAxIHNlY29uZFxuICAgICAgICBhd2FpdCB2ZXJpZmllci50ZXN0VmVyaWZ5Q2VydGlmaWNhdGVDaGFpbih2ZXJpZmllci5nZXRSb290Q2VydGlmaWNhdGVzKCksIExFQUZfQ0VSVF9CQVNFNjRfRU5DT0RFRCwgSU5URVJNRURJQVRFX0NBX0JBU0U2NF9FTkNPREVEKVxuICAgICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICAgIGplc3QucnVuT25seVBlbmRpbmdUaW1lcnMoKVxuICAgICAgICBqZXN0LnVzZVJlYWxUaW1lcnMoKVxuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIGNhY2hlIE9DU1AgcmVzcG9uc2VzIGZvciBhIGxpbWl0ZWQgdGltZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgamVzdC51c2VGYWtlVGltZXJzKClcbiAgICAgICAgamVzdC5zZXRTeXN0ZW1UaW1lKENMT0NLX0RBVEUpXG4gICAgICAgIGNvbnN0IHZlcmlmaWVyID0gbmV3IFNpZ25lZEpXVFZlcmlmaWVyVGVzdChbQnVmZmVyLmZyb20oUk9PVF9DQV9CQVNFNjRfRU5DT0RFRCwgJ2Jhc2U2NCcpXSwgdHJ1ZSwgRW52aXJvbm1lbnQuUFJPRFVDVElPTiwgXCJjb20uZXhhbXBsZVwiLCAxMjM0KTtcbiAgICAgICAgbGV0IHNweSA9IGplc3Quc3B5T24odmVyaWZpZXIsICd2ZXJpZnlDZXJ0aWZpY2F0ZUNoYWluV2l0aG91dENhY2hpbmcnKS5tb2NrSW1wbGVtZW50YXRpb24oKF8sIF8yLCBfMywgXzQpID0+IFByb21pc2UucmVzb2x2ZShuZXcgWDUwOUNlcnRpZmljYXRlKEJ1ZmZlci5mcm9tKExFQUZfQ0VSVF9CQVNFNjRfRU5DT0RFRCwgJ2Jhc2U2NCcpKS5wdWJsaWNLZXkpKTtcbiAgICAgICAgYXdhaXQgdmVyaWZpZXIudGVzdFZlcmlmeUNlcnRpZmljYXRlQ2hhaW4odmVyaWZpZXIuZ2V0Um9vdENlcnRpZmljYXRlcygpLCBMRUFGX0NFUlRfQkFTRTY0X0VOQ09ERUQsIElOVEVSTUVESUFURV9DQV9CQVNFNjRfRU5DT0RFRClcbiAgICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgICBqZXN0LnNldFN5c3RlbVRpbWUoQ0xPQ0tfREFURSArIDE1ICogNjAgKiAxXzAwMCkgLy8gMTUgbWludXRlc1xuICAgICAgICBhd2FpdCB2ZXJpZmllci50ZXN0VmVyaWZ5Q2VydGlmaWNhdGVDaGFpbih2ZXJpZmllci5nZXRSb290Q2VydGlmaWNhdGVzKCksIExFQUZfQ0VSVF9CQVNFNjRfRU5DT0RFRCwgSU5URVJNRURJQVRFX0NBX0JBU0U2NF9FTkNPREVEKVxuICAgICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgICAgIGplc3QucnVuT25seVBlbmRpbmdUaW1lcnMoKVxuICAgICAgICBqZXN0LnVzZVJlYWxUaW1lcnMoKVxuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIG5vdCByZXR1cm4gY2FjaGVkIE9DU1AgcmVzcG9uc2VzIGZvciBhIGRpZmZlcmVudCBjaGFpbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgamVzdC51c2VGYWtlVGltZXJzKClcbiAgICAgICAgamVzdC5zZXRTeXN0ZW1UaW1lKENMT0NLX0RBVEUpXG4gICAgICAgIGNvbnN0IHZlcmlmaWVyID0gbmV3IFNpZ25lZEpXVFZlcmlmaWVyVGVzdChbQnVmZmVyLmZyb20oUk9PVF9DQV9CQVNFNjRfRU5DT0RFRCwgJ2Jhc2U2NCcpXSwgdHJ1ZSwgRW52aXJvbm1lbnQuUFJPRFVDVElPTiwgXCJjb20uZXhhbXBsZVwiLCAxMjM0KTtcbiAgICAgICAgbGV0IHNweSA9IGplc3Quc3B5T24odmVyaWZpZXIsICd2ZXJpZnlDZXJ0aWZpY2F0ZUNoYWluV2l0aG91dENhY2hpbmcnKS5tb2NrSW1wbGVtZW50YXRpb24oKF8sIF8yLCBfMywgXzQpID0+IFByb21pc2UucmVzb2x2ZShuZXcgWDUwOUNlcnRpZmljYXRlKEJ1ZmZlci5mcm9tKExFQUZfQ0VSVF9CQVNFNjRfRU5DT0RFRCwgJ2Jhc2U2NCcpKS5wdWJsaWNLZXkpKTtcbiAgICAgICAgYXdhaXQgdmVyaWZpZXIudGVzdFZlcmlmeUNlcnRpZmljYXRlQ2hhaW4odmVyaWZpZXIuZ2V0Um9vdENlcnRpZmljYXRlcygpLCBMRUFGX0NFUlRfQkFTRTY0X0VOQ09ERUQsIElOVEVSTUVESUFURV9DQV9CQVNFNjRfRU5DT0RFRClcbiAgICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgICBqZXN0LnNldFN5c3RlbVRpbWUoQ0xPQ0tfREFURSArIDE1ICogNjAgKiAxXzAwMCkgLy8gMTUgbWludXRlc1xuICAgICAgICBhd2FpdCB2ZXJpZmllci50ZXN0VmVyaWZ5Q2VydGlmaWNhdGVDaGFpbih2ZXJpZmllci5nZXRSb290Q2VydGlmaWNhdGVzKCksIFJFQUxfQVBQTEVfU0lHTklOR19DRVJUSUZJQ0FURV9CQVNFNjRfRU5DT0RFRCwgUkVBTF9BUFBMRV9JTlRFUk1FRElBVEVfQkFTRTY0X0VOQ09ERUQpXG4gICAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICAgICAgamVzdC5ydW5Pbmx5UGVuZGluZ1RpbWVycygpXG4gICAgICAgIGplc3QudXNlUmVhbFRpbWVycygpXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgbm90IHJldHVybiBjYWNoZWQgT0NTUCByZXNwb25zZXMgZm9yIGEgc2xpZ2h0bHkgZGlmZmVyZW50IGNoYWluJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBqZXN0LnVzZUZha2VUaW1lcnMoKVxuICAgICAgICBqZXN0LnNldFN5c3RlbVRpbWUoQ0xPQ0tfREFURSlcbiAgICAgICAgY29uc3QgdmVyaWZpZXIgPSBuZXcgU2lnbmVkSldUVmVyaWZpZXJUZXN0KFtCdWZmZXIuZnJvbShST09UX0NBX0JBU0U2NF9FTkNPREVELCAnYmFzZTY0JyldLCB0cnVlLCBFbnZpcm9ubWVudC5QUk9EVUNUSU9OLCBcImNvbS5leGFtcGxlXCIsIDEyMzQpO1xuICAgICAgICBsZXQgc3B5ID0gamVzdC5zcHlPbih2ZXJpZmllciwgJ3ZlcmlmeUNlcnRpZmljYXRlQ2hhaW5XaXRob3V0Q2FjaGluZycpLm1vY2tJbXBsZW1lbnRhdGlvbigoXywgXzIsIF8zLCBfNCkgPT4gUHJvbWlzZS5yZXNvbHZlKG5ldyBYNTA5Q2VydGlmaWNhdGUoQnVmZmVyLmZyb20oTEVBRl9DRVJUX0JBU0U2NF9FTkNPREVELCAnYmFzZTY0JykpLnB1YmxpY0tleSkpO1xuICAgICAgICBhd2FpdCB2ZXJpZmllci50ZXN0VmVyaWZ5Q2VydGlmaWNhdGVDaGFpbih2ZXJpZmllci5nZXRSb290Q2VydGlmaWNhdGVzKCksIExFQUZfQ0VSVF9CQVNFNjRfRU5DT0RFRCwgSU5URVJNRURJQVRFX0NBX0JBU0U2NF9FTkNPREVEKVxuICAgICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICAgIGplc3Quc2V0U3lzdGVtVGltZShDTE9DS19EQVRFICsgMTUgKiA2MCAqIDFfMDAwKSAvLyAxNSBtaW51dGVzXG4gICAgICAgIGF3YWl0IHZlcmlmaWVyLnRlc3RWZXJpZnlDZXJ0aWZpY2F0ZUNoYWluKHZlcmlmaWVyLmdldFJvb3RDZXJ0aWZpY2F0ZXMoKSwgTEVBRl9DRVJUX0JBU0U2NF9FTkNPREVELCBSRUFMX0FQUExFX0lOVEVSTUVESUFURV9CQVNFNjRfRU5DT0RFRClcbiAgICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgICAgICBqZXN0LnJ1bk9ubHlQZW5kaW5nVGltZXJzKClcbiAgICAgICAgamVzdC51c2VSZWFsVGltZXJzKClcbiAgICB9KVxufSlcblxuZGVzY3JpYmUoXCJEZWNvZGluZyBjaGVja3NcIiwgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZmFpbCB0byB2ZXJpZnkgd2l0aCBhIG1pc3NpbmcgeDVjIGhlYWRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdmVyaWZpZXIgPSBnZXRTaWduZWRQYXlsb2FkVmVyaWZpZXJXaXRoRGVmYXVsdEFwcEFwcGxlSWQoRW52aXJvbm1lbnQuUFJPRFVDVElPTiwgXCJjb20uZXhhbXBsZVwiKVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgbWlzc2luZ1g1Q0hlYWRlckNsYWltID0gcmVhZEZpbGUoJ3Rlc3RzL3Jlc291cmNlcy9tb2NrX3NpZ25lZF9kYXRhL21pc3NpbmdYNUNIZWFkZXJDbGFpbScpXG4gICAgICAgICAgICBhd2FpdCB2ZXJpZmllci52ZXJpZnlBbmREZWNvZGVOb3RpZmljYXRpb24obWlzc2luZ1g1Q0hlYWRlckNsYWltKVxuICAgICAgICAgICAgYXNzZXJ0KGZhbHNlKVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBleHBlY3QoZSkudG9CZUluc3RhbmNlT2YoVmVyaWZpY2F0aW9uRXhjZXB0aW9uKVxuICAgICAgICAgICAgZXhwZWN0KChlIGFzIFZlcmlmaWNhdGlvbkV4Y2VwdGlvbikuc3RhdHVzKS50b0VxdWFsKFZlcmlmaWNhdGlvblN0YXR1cy5JTlZBTElEX0NFUlRJRklDQVRFKVxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgZmFpbCB0byB2ZXJpZnkgd2l0aCBhbiBpbnZhbGlkIGJ1bmRsZSBpZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdmVyaWZpZXIgPSBnZXRTaWduZWRQYXlsb2FkVmVyaWZpZXJXaXRoRGVmYXVsdEFwcEFwcGxlSWQoRW52aXJvbm1lbnQuU0FOREJPWCwgXCJjb20uZXhhbXBsZVwiKVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3Qgd3JvbmdCdW5kbGVJZCA9IHJlYWRGaWxlKCd0ZXN0cy9yZXNvdXJjZXMvbW9ja19zaWduZWRfZGF0YS93cm9uZ0J1bmRsZUlkJylcbiAgICAgICAgICAgIGF3YWl0IHZlcmlmaWVyLnZlcmlmeUFuZERlY29kZU5vdGlmaWNhdGlvbih3cm9uZ0J1bmRsZUlkKVxuICAgICAgICAgICAgYXNzZXJ0KGZhbHNlKVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBleHBlY3QoZSkudG9CZUluc3RhbmNlT2YoVmVyaWZpY2F0aW9uRXhjZXB0aW9uKVxuICAgICAgICAgICAgZXhwZWN0KChlIGFzIFZlcmlmaWNhdGlvbkV4Y2VwdGlvbikuc3RhdHVzKS50b0VxdWFsKFZlcmlmaWNhdGlvblN0YXR1cy5JTlZBTElEX0FQUF9JREVOVElGSUVSKVxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgZmFpbCB0byB2ZXJpZnkgd2l0aCBhbiBpbnZhbGlkIGJ1bmRsZSBpZCBmb3IgdHJhbnNhY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB2ZXJpZmllciA9IGdldFNpZ25lZFBheWxvYWRWZXJpZmllcldpdGhEZWZhdWx0QXBwQXBwbGVJZChFbnZpcm9ubWVudC5TQU5EQk9YLCBcImNvbS5leGFtcGxlLnhcIilcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uSW5mbyA9IHJlYWRGaWxlKCd0ZXN0cy9yZXNvdXJjZXMvbW9ja19zaWduZWRfZGF0YS90cmFuc2FjdGlvbkluZm8nKVxuICAgICAgICAgICAgYXdhaXQgdmVyaWZpZXIudmVyaWZ5QW5kRGVjb2RlVHJhbnNhY3Rpb24odHJhbnNhY3Rpb25JbmZvKVxuICAgICAgICAgICAgYXNzZXJ0KGZhbHNlKVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBleHBlY3QoZSkudG9CZUluc3RhbmNlT2YoVmVyaWZpY2F0aW9uRXhjZXB0aW9uKVxuICAgICAgICAgICAgZXhwZWN0KChlIGFzIFZlcmlmaWNhdGlvbkV4Y2VwdGlvbikuc3RhdHVzKS50b0VxdWFsKFZlcmlmaWNhdGlvblN0YXR1cy5JTlZBTElEX0FQUF9JREVOVElGSUVSKVxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgZmFpbCB0byB2ZXJpZnkgd2l0aCBhbiBpbnZhbGlkIGVudmlyb25tZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdmVyaWZpZXIgPSBnZXRTaWduZWRQYXlsb2FkVmVyaWZpZXJXaXRoRGVmYXVsdEFwcEFwcGxlSWQoRW52aXJvbm1lbnQuUFJPRFVDVElPTiwgXCJjb20uZXhhbXBsZVwiKVxuICAgICAgICAgICAgY29uc3QgdGVzdE5vdGlmaWNhdGlvbiA9IHJlYWRGaWxlKCd0ZXN0cy9yZXNvdXJjZXMvbW9ja19zaWduZWRfZGF0YS90ZXN0Tm90aWZpY2F0aW9uJylcbiAgICAgICAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGF3YWl0IHZlcmlmaWVyLnZlcmlmeUFuZERlY29kZU5vdGlmaWNhdGlvbih0ZXN0Tm90aWZpY2F0aW9uKVxuICAgICAgICAgICAgYXdhaXQgdmVyaWZpZXIudmVyaWZ5QW5kRGVjb2RlTm90aWZpY2F0aW9uKHRlc3ROb3RpZmljYXRpb24pXG4gICAgICAgICAgICBhc3NlcnQoZmFsc2UpXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGV4cGVjdChlKS50b0JlSW5zdGFuY2VPZihWZXJpZmljYXRpb25FeGNlcHRpb24pXG4gICAgICAgICAgICBleHBlY3QoKGUgYXMgVmVyaWZpY2F0aW9uRXhjZXB0aW9uKS5zdGF0dXMpLnRvRXF1YWwoVmVyaWZpY2F0aW9uU3RhdHVzLklOVkFMSURfRU5WSVJPTk1FTlQpXG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCBmYWlsIHRvIHZlcmlmeSB3aXRoIGEgbWFsZm9ybWVkIEpXVCB3aXRoIHRvbyBtYW55IHBhcnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB2ZXJpZmllciA9IGdldFNpZ25lZFBheWxvYWRWZXJpZmllcldpdGhEZWZhdWx0QXBwQXBwbGVJZChFbnZpcm9ubWVudC5TQU5EQk9YLCBcImNvbS5leGFtcGxlXCIpXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB2ZXJpZmllci52ZXJpZnlBbmREZWNvZGVOb3RpZmljYXRpb24oXCJhLmIuYy5kXCIpXG4gICAgICAgICAgICBhc3NlcnQoZmFsc2UpXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGV4cGVjdChlKS50b0JlSW5zdGFuY2VPZihWZXJpZmljYXRpb25FeGNlcHRpb24pXG4gICAgICAgICAgICBleHBlY3QoKGUgYXMgVmVyaWZpY2F0aW9uRXhjZXB0aW9uKS5zdGF0dXMpLnRvRXF1YWwoVmVyaWZpY2F0aW9uU3RhdHVzLlZFUklGSUNBVElPTl9GQUlMVVJFKVxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgZmFpbCB0byB2ZXJpZnkgd2l0aCBhIG1hbGZvcm1lZCBKV1QnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHZlcmlmaWVyID0gZ2V0U2lnbmVkUGF5bG9hZFZlcmlmaWVyV2l0aERlZmF1bHRBcHBBcHBsZUlkKEVudmlyb25tZW50LlNBTkRCT1gsIFwiY29tLmV4YW1wbGVcIilcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHZlcmlmaWVyLnZlcmlmeUFuZERlY29kZU5vdGlmaWNhdGlvbihcImEuYi5jXCIpXG4gICAgICAgICAgICBhc3NlcnQoZmFsc2UpXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGV4cGVjdChlKS50b0JlSW5zdGFuY2VPZihWZXJpZmljYXRpb25FeGNlcHRpb24pXG4gICAgICAgICAgICBleHBlY3QoKGUgYXMgVmVyaWZpY2F0aW9uRXhjZXB0aW9uKS5zdGF0dXMpLnRvRXF1YWwoVmVyaWZpY2F0aW9uU3RhdHVzLlZFUklGSUNBVElPTl9GQUlMVVJFKVxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgdmVyaWZ5IGFuZCBkZWNvZGUgYSB2YWxpZCBub3RpZmljYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHZlcmlmaWVyID0gZ2V0U2lnbmVkUGF5bG9hZFZlcmlmaWVyV2l0aERlZmF1bHRBcHBBcHBsZUlkKEVudmlyb25tZW50LlNBTkRCT1gsIFwiY29tLmV4YW1wbGVcIilcbiAgICAgICAgY29uc3QgdGVzdE5vdGlmaWNhdGlvbiA9IHJlYWRGaWxlKCd0ZXN0cy9yZXNvdXJjZXMvbW9ja19zaWduZWRfZGF0YS90ZXN0Tm90aWZpY2F0aW9uJylcbiAgICAgICAgY29uc3Qgbm90aWZpY2F0aW9uID0gYXdhaXQgdmVyaWZpZXIudmVyaWZ5QW5kRGVjb2RlTm90aWZpY2F0aW9uKHRlc3ROb3RpZmljYXRpb24pXG4gICAgICAgIGV4cGVjdChub3RpZmljYXRpb24ubm90aWZpY2F0aW9uVHlwZSkudG9FcXVhbChcIlRFU1RcIilcbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCB2ZXJpZnkgYW5kIGRlY29kZSBhIHZhbGlkIHJlbmV3YWwgaW5mbycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdmVyaWZpZXIgPWdldFNpZ25lZFBheWxvYWRWZXJpZmllcldpdGhEZWZhdWx0QXBwQXBwbGVJZChFbnZpcm9ubWVudC5TQU5EQk9YLCBcImNvbS5leGFtcGxlXCIpXG5cbiAgICAgICAgY29uc3QgcmVuZXdhbEluZm8gPSByZWFkRmlsZSgndGVzdHMvcmVzb3VyY2VzL21vY2tfc2lnbmVkX2RhdGEvcmVuZXdhbEluZm8nKVxuICAgICAgICBjb25zdCBub3RpZmljYXRpb24gPSBhd2FpdCB2ZXJpZmllci52ZXJpZnlBbmREZWNvZGVSZW5ld2FsSW5mbyhyZW5ld2FsSW5mbylcbiAgICAgICAgZXhwZWN0KG5vdGlmaWNhdGlvbi5lbnZpcm9ubWVudCkudG9FcXVhbChFbnZpcm9ubWVudC5TQU5EQk9YKVxuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIHZlcmlmeSBhbmQgZGVjb2RlIGEgdmFsaWQgdHJhbnNhY3Rpb24gaW5mbycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdmVyaWZpZXIgPSBnZXRTaWduZWRQYXlsb2FkVmVyaWZpZXJXaXRoRGVmYXVsdEFwcEFwcGxlSWQoRW52aXJvbm1lbnQuU0FOREJPWCwgXCJjb20uZXhhbXBsZVwiKVxuXG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uSW5mbyA9IHJlYWRGaWxlKCd0ZXN0cy9yZXNvdXJjZXMvbW9ja19zaWduZWRfZGF0YS90cmFuc2FjdGlvbkluZm8nKVxuICAgICAgICBjb25zdCBub3RpZmljYXRpb24gPSBhd2FpdCB2ZXJpZmllci52ZXJpZnlBbmREZWNvZGVSZW5ld2FsSW5mbyh0cmFuc2FjdGlvbkluZm8pXG4gICAgICAgIGV4cGVjdChub3RpZmljYXRpb24uZW52aXJvbm1lbnQpLnRvRXF1YWwoRW52aXJvbm1lbnQuU0FOREJPWClcbiAgICB9KVxufSk7Il19